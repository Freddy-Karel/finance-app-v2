"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "_action-browser_src_server_actions_queries_ts";
exports.ids = ["_action-browser_src_server_actions_queries_ts"];
exports.modules = {

/***/ "(action-browser)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getCurrentRole: () => (/* binding */ getCurrentRole),\n/* harmony export */   requireRole: () => (/* binding */ requireRole)\n/* harmony export */ });\n/* harmony import */ var _clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @clerk/nextjs/server */ \"(action-browser)/./node_modules/.pnpm/@clerk+nextjs@5.3.1_next@15_20ea36d09dc70bbbcc56b8a0d9ae486b/node_modules/@clerk/nextjs/dist/esm/app-router/server/auth.js\");\n\nasync function getCurrentRole() {\n    if (process.env.E2E_ROLE === \"operator\" || process.env.E2E_ROLE === \"manager\" || process.env.E2E_ROLE === \"auditor\") return process.env.E2E_ROLE;\n    const { userId, sessionClaims } = (0,_clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_0__.auth)();\n    if (!userId) throw new Error(\"Unauthenticated\");\n    return sessionClaims?.role ?? \"operator\";\n}\nasync function requireRole(allowed) {\n    const role = await getCurrentRole();\n    if (!allowed.includes(role)) throw new Error(\"Forbidden\");\n    return role;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL3NyYy9saWIvYXV0aC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBNEM7QUFFckMsZUFBZUM7SUFDcEIsSUFBSUMsUUFBUUMsR0FBRyxDQUFDQyxRQUFRLEtBQUssY0FBY0YsUUFBUUMsR0FBRyxDQUFDQyxRQUFRLEtBQUssYUFBYUYsUUFBUUMsR0FBRyxDQUFDQyxRQUFRLEtBQUssV0FBVyxPQUFPRixRQUFRQyxHQUFHLENBQUNDLFFBQVE7SUFDaEosTUFBTSxFQUFFQyxNQUFNLEVBQUVDLGFBQWEsRUFBRSxHQUFHTiwwREFBSUE7SUFBSSxJQUFJLENBQUNLLFFBQVEsTUFBTSxJQUFJRSxNQUFNO0lBQ3ZFLE9BQU8sZUFBZ0JDLFFBQTZCO0FBQ3REO0FBQ08sZUFBZUMsWUFBWUMsT0FBZTtJQUFJLE1BQU1GLE9BQU8sTUFBTVA7SUFBa0IsSUFBSSxDQUFDUyxRQUFRQyxRQUFRLENBQUNILE9BQU8sTUFBTSxJQUFJRCxNQUFNO0lBQWMsT0FBT0M7QUFBTSIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxCQzI0MVxcTXVzaWNcXGZpbmFuY2UtYXBwLXYxLW1haW5cXGZpbmFuY2UtYXBwLXYxLW1haW5cXHNyY1xcbGliXFxhdXRoLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGF1dGggfSBmcm9tIFwiQGNsZXJrL25leHRqcy9zZXJ2ZXJcIjtcbmV4cG9ydCB0eXBlIFJvbGUgPSBcIm9wZXJhdG9yXCIgfCBcIm1hbmFnZXJcIiB8IFwiYXVkaXRvclwiO1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1cnJlbnRSb2xlKCk6IFByb21pc2U8Um9sZT4ge1xuICBpZiAocHJvY2Vzcy5lbnYuRTJFX1JPTEUgPT09IFwib3BlcmF0b3JcIiB8fCBwcm9jZXNzLmVudi5FMkVfUk9MRSA9PT0gXCJtYW5hZ2VyXCIgfHwgcHJvY2Vzcy5lbnYuRTJFX1JPTEUgPT09IFwiYXVkaXRvclwiKSByZXR1cm4gcHJvY2Vzcy5lbnYuRTJFX1JPTEUgYXMgUm9sZTtcbiAgY29uc3QgeyB1c2VySWQsIHNlc3Npb25DbGFpbXMgfSA9IGF1dGgoKTsgaWYgKCF1c2VySWQpIHRocm93IG5ldyBFcnJvcihcIlVuYXV0aGVudGljYXRlZFwiKTtcbiAgcmV0dXJuIChzZXNzaW9uQ2xhaW1zPy5yb2xlIGFzIFJvbGUgfCB1bmRlZmluZWQpID8/IFwib3BlcmF0b3JcIjtcbn1cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXF1aXJlUm9sZShhbGxvd2VkOiBSb2xlW10pIHsgY29uc3Qgcm9sZSA9IGF3YWl0IGdldEN1cnJlbnRSb2xlKCk7IGlmICghYWxsb3dlZC5pbmNsdWRlcyhyb2xlKSkgdGhyb3cgbmV3IEVycm9yKFwiRm9yYmlkZGVuXCIpOyByZXR1cm4gcm9sZTsgfVxuIl0sIm5hbWVzIjpbImF1dGgiLCJnZXRDdXJyZW50Um9sZSIsInByb2Nlc3MiLCJlbnYiLCJFMkVfUk9MRSIsInVzZXJJZCIsInNlc3Npb25DbGFpbXMiLCJFcnJvciIsInJvbGUiLCJyZXF1aXJlUm9sZSIsImFsbG93ZWQiLCJpbmNsdWRlcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(action-browser)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(action-browser)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst prisma = global.__prisma ??= new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\nif (true) global.__prisma = prisma;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL3NyYy9saWIvcHJpc21hLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUE4QztBQVN2QyxNQUFNQyxTQUFVQyxPQUFPQyxRQUFRLEtBQUssSUFBSUgsd0RBQVlBLEdBQUk7QUFDL0QsSUFBSUksSUFBcUMsRUFBRUYsT0FBT0MsUUFBUSxHQUFHRiIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxCQzI0MVxcTXVzaWNcXGZpbmFuY2UtYXBwLXYxLW1haW5cXGZpbmFuY2UtYXBwLXYxLW1haW5cXHNyY1xcbGliXFxwcmlzbWEudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuXG4vLyBFbnN1cmUgYSBzaW5nbGUgUHJpc21hQ2xpZW50IGluc3RhbmNlIGluIGRldmVsb3BtZW50IHRvIGF2b2lkIGV4aGF1c3Rpbmdcbi8vIGRhdGFiYXNlIGNvbm5lY3Rpb25zIGR1cmluZyBITVIgKHNlZSBQcmlzbWEgZG9jcykuXG5kZWNsYXJlIGdsb2JhbCB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby12YXJcbiAgdmFyIF9fcHJpc21hOiBQcmlzbWFDbGllbnQgfCB1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCBjb25zdCBwcmlzbWEgPSAoZ2xvYmFsLl9fcHJpc21hID8/PSBuZXcgUHJpc21hQ2xpZW50KCkpO1xuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIGdsb2JhbC5fX3ByaXNtYSA9IHByaXNtYTtcbiJdLCJuYW1lcyI6WyJQcmlzbWFDbGllbnQiLCJwcmlzbWEiLCJnbG9iYWwiLCJfX3ByaXNtYSIsInByb2Nlc3MiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/./src/lib/prisma.ts\n");

/***/ }),

/***/ "(action-browser)/./src/server/actions/queries.ts":
/*!***************************************!*\
  !*** ./src/server/actions/queries.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getDistributionProposal: () => (/* binding */ getDistributionProposal),\n/* harmony export */   getEnvelopeBalances: () => (/* binding */ getEnvelopeBalances)\n/* harmony export */ });\n/* harmony import */ var private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! private-next-rsc-server-reference */ \"(action-browser)/./node_modules/.pnpm/next@15.0.3_@playwright+tes_c0fbebec67a33fb30e42c14d3a81a9d2/node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js\");\n/* harmony import */ var private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! private-next-rsc-action-encryption */ \"(action-browser)/./node_modules/.pnpm/next@15.0.3_@playwright+tes_c0fbebec67a33fb30e42c14d3a81a9d2/node_modules/next/dist/server/app-render/encryption.js\");\n/* harmony import */ var private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _server_queries_envelopes__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/server/queries/envelopes */ \"(action-browser)/./src/server/queries/envelopes.ts\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/auth */ \"(action-browser)/./src/lib/auth.ts\");\n/* harmony import */ var _server_queries_ledger__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/server/queries/ledger */ \"(action-browser)/./src/server/queries/ledger.ts\");\n/* harmony import */ var _server_queries_rules__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/server/queries/rules */ \"(action-browser)/./src/server/queries/rules.ts\");\n/* harmony import */ var _server_validators_distribution__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/server/validators/distribution */ \"(action-browser)/./src/server/validators/distribution.ts\");\n/* harmony import */ var private_next_rsc_action_validate__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! private-next-rsc-action-validate */ \"(action-browser)/./node_modules/.pnpm/next@15.0.3_@playwright+tes_c0fbebec67a33fb30e42c14d3a81a9d2/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js\");\n/* __next_internal_action_entry_do_not_use__ {\"009d5aa4d3c64a2f9e102a4a09330dfe071facef5f\":\"getEnvelopeBalances\",\"40d6f2193615c5627c3e395d01e43b40a47711bcd6\":\"getDistributionProposal\"} */ \n\n\n\n\n\n\nasync function getEnvelopeBalances() {\n    await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_3__.requireRole)([\n        \"operator\",\n        \"manager\",\n        \"auditor\"\n    ]);\n    return (0,_server_queries_envelopes__WEBPACK_IMPORTED_MODULE_2__.getAllEnvelopeBalances)();\n}\nasync function getDistributionProposal(input) {\n    await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_3__.requireRole)([\n        \"operator\",\n        \"manager\"\n    ]);\n    const p = _server_validators_distribution__WEBPACK_IMPORTED_MODULE_6__.GetDistributionProposalSchema.safeParse(input);\n    if (!p.success) throw new Error(p.error.errors.map((e)=>e.message).join(\"; \"));\n    const day = await (0,_server_queries_ledger__WEBPACK_IMPORTED_MODULE_4__.getDayTotals)(p.data.date);\n    const rule = await (0,_server_queries_rules__WEBPACK_IMPORTED_MODULE_5__.getActiveDistributionRule)();\n    if (!rule || !rule.items.length) return {\n        onHand: day.onHand,\n        items: []\n    };\n    const mapped = rule.items.map((it)=>({\n            envelopeId: it.envelopeId,\n            percent: it.percent,\n            envelopeName: it.envelope.name\n        }));\n    const items = (0,_server_queries_rules__WEBPACK_IMPORTED_MODULE_5__.computeProposal)(day.onHand, mapped);\n    return {\n        onHand: day.onHand,\n        items\n    };\n}\n\n(0,private_next_rsc_action_validate__WEBPACK_IMPORTED_MODULE_7__.ensureServerEntryExports)([\n    getEnvelopeBalances,\n    getDistributionProposal\n]);\n(0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(getEnvelopeBalances, \"009d5aa4d3c64a2f9e102a4a09330dfe071facef5f\", null);\n(0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(getDistributionProposal, \"40d6f2193615c5627c3e395d01e43b40a47711bcd6\", null);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL3NyYy9zZXJ2ZXIvYWN0aW9ucy9xdWVyaWVzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDb0U7QUFDM0I7QUFDYztBQUM2QjtBQUNIO0FBRTFFLGVBQWVNO0lBQXVCLE1BQU1MLHNEQUFXQSxDQUFDO1FBQUM7UUFBVztRQUFVO0tBQVU7SUFBRyxPQUFPRCxpRkFBc0JBO0FBQUk7QUFDNUgsZUFBZU8sd0JBQXdCQyxLQUFtQjtJQUMvRCxNQUFNUCxzREFBV0EsQ0FBQztRQUFDO1FBQVc7S0FBVTtJQUN4QyxNQUFNUSxJQUFFSiwwRkFBNkJBLENBQUNLLFNBQVMsQ0FBQ0Y7SUFBUSxJQUFHLENBQUNDLEVBQUVFLE9BQU8sRUFBRSxNQUFNLElBQUlDLE1BQU1ILEVBQUVJLEtBQUssQ0FBQ0MsTUFBTSxDQUFDQyxHQUFHLENBQUNDLENBQUFBLElBQUdBLEVBQUVDLE9BQU8sRUFBRUMsSUFBSSxDQUFDO0lBQzdILE1BQU1DLE1BQUksTUFBTWpCLG9FQUFZQSxDQUFDTyxFQUFFVyxJQUFJLENBQUNDLElBQUk7SUFBRyxNQUFNQyxPQUFLLE1BQU1uQixnRkFBeUJBO0lBQ3JGLElBQUcsQ0FBQ21CLFFBQVEsQ0FBQ0EsS0FBS0MsS0FBSyxDQUFDQyxNQUFNLEVBQUUsT0FBTztRQUFFQyxRQUFRTixJQUFJTSxNQUFNO1FBQUVGLE9BQU8sRUFBRTtJQUFVO0lBQ2hGLE1BQU1HLFNBQU9KLEtBQUtDLEtBQUssQ0FBQ1IsR0FBRyxDQUFDWSxDQUFBQSxLQUFLO1lBQUVDLFlBQVdELEdBQUdDLFVBQVU7WUFBRUMsU0FBUUYsR0FBR0UsT0FBTztZQUFFQyxjQUFhSCxHQUFHSSxRQUFRLENBQUNDLElBQUk7UUFBQztJQUMvRyxNQUFNVCxRQUFNbkIsc0VBQWVBLENBQUNlLElBQUlNLE1BQU0sRUFBRUM7SUFBUyxPQUFPO1FBQUVELFFBQVFOLElBQUlNLE1BQU07UUFBRUY7SUFBTTtBQUN0Rjs7O0lBUnNCakI7SUFDQUM7O0FBREFELDBGQUFBQSxDQUFBQTtBQUNBQywwRkFBQUEsQ0FBQUEiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcQkMyNDFcXE11c2ljXFxmaW5hbmNlLWFwcC12MS1tYWluXFxmaW5hbmNlLWFwcC12MS1tYWluXFxzcmNcXHNlcnZlclxcYWN0aW9uc1xccXVlcmllcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzZXJ2ZXJcIjtcbmltcG9ydCB7IGdldEFsbEVudmVsb3BlQmFsYW5jZXMgfSBmcm9tIFwiQC9zZXJ2ZXIvcXVlcmllcy9lbnZlbG9wZXNcIjtcbmltcG9ydCB7IHJlcXVpcmVSb2xlIH0gZnJvbSBcIkAvbGliL2F1dGhcIjtcbmltcG9ydCB7IGdldERheVRvdGFscyB9IGZyb20gXCJAL3NlcnZlci9xdWVyaWVzL2xlZGdlclwiO1xuaW1wb3J0IHsgZ2V0QWN0aXZlRGlzdHJpYnV0aW9uUnVsZSwgY29tcHV0ZVByb3Bvc2FsIH0gZnJvbSBcIkAvc2VydmVyL3F1ZXJpZXMvcnVsZXNcIjtcbmltcG9ydCB7IEdldERpc3RyaWJ1dGlvblByb3Bvc2FsU2NoZW1hIH0gZnJvbSBcIkAvc2VydmVyL3ZhbGlkYXRvcnMvZGlzdHJpYnV0aW9uXCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRFbnZlbG9wZUJhbGFuY2VzKCl7IGF3YWl0IHJlcXVpcmVSb2xlKFtcIm9wZXJhdG9yXCIsXCJtYW5hZ2VyXCIsXCJhdWRpdG9yXCJdKTsgcmV0dXJuIGdldEFsbEVudmVsb3BlQmFsYW5jZXMoKTsgfVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldERpc3RyaWJ1dGlvblByb3Bvc2FsKGlucHV0OntkYXRlOnN0cmluZ30pe1xuICBhd2FpdCByZXF1aXJlUm9sZShbXCJvcGVyYXRvclwiLFwibWFuYWdlclwiXSk7XG4gIGNvbnN0IHA9R2V0RGlzdHJpYnV0aW9uUHJvcG9zYWxTY2hlbWEuc2FmZVBhcnNlKGlucHV0KTsgaWYoIXAuc3VjY2VzcykgdGhyb3cgbmV3IEVycm9yKHAuZXJyb3IuZXJyb3JzLm1hcChlPT5lLm1lc3NhZ2UpLmpvaW4oXCI7IFwiKSk7XG4gIGNvbnN0IGRheT1hd2FpdCBnZXREYXlUb3RhbHMocC5kYXRhLmRhdGUpOyBjb25zdCBydWxlPWF3YWl0IGdldEFjdGl2ZURpc3RyaWJ1dGlvblJ1bGUoKTtcbiAgaWYoIXJ1bGUgfHwgIXJ1bGUuaXRlbXMubGVuZ3RoKSByZXR1cm4geyBvbkhhbmQ6IGRheS5vbkhhbmQsIGl0ZW1zOiBbXSBhcyBhbnlbXSB9O1xuICBjb25zdCBtYXBwZWQ9cnVsZS5pdGVtcy5tYXAoaXQ9Pih7IGVudmVsb3BlSWQ6aXQuZW52ZWxvcGVJZCwgcGVyY2VudDppdC5wZXJjZW50LCBlbnZlbG9wZU5hbWU6aXQuZW52ZWxvcGUubmFtZSB9KSk7XG4gIGNvbnN0IGl0ZW1zPWNvbXB1dGVQcm9wb3NhbChkYXkub25IYW5kLCBtYXBwZWQpOyByZXR1cm4geyBvbkhhbmQ6IGRheS5vbkhhbmQsIGl0ZW1zIH07XG59XG4iXSwibmFtZXMiOlsiZ2V0QWxsRW52ZWxvcGVCYWxhbmNlcyIsInJlcXVpcmVSb2xlIiwiZ2V0RGF5VG90YWxzIiwiZ2V0QWN0aXZlRGlzdHJpYnV0aW9uUnVsZSIsImNvbXB1dGVQcm9wb3NhbCIsIkdldERpc3RyaWJ1dGlvblByb3Bvc2FsU2NoZW1hIiwiZ2V0RW52ZWxvcGVCYWxhbmNlcyIsImdldERpc3RyaWJ1dGlvblByb3Bvc2FsIiwiaW5wdXQiLCJwIiwic2FmZVBhcnNlIiwic3VjY2VzcyIsIkVycm9yIiwiZXJyb3IiLCJlcnJvcnMiLCJtYXAiLCJlIiwibWVzc2FnZSIsImpvaW4iLCJkYXkiLCJkYXRhIiwiZGF0ZSIsInJ1bGUiLCJpdGVtcyIsImxlbmd0aCIsIm9uSGFuZCIsIm1hcHBlZCIsIml0IiwiZW52ZWxvcGVJZCIsInBlcmNlbnQiLCJlbnZlbG9wZU5hbWUiLCJlbnZlbG9wZSIsIm5hbWUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/./src/server/actions/queries.ts\n");

/***/ }),

/***/ "(action-browser)/./src/server/queries/envelopes.ts":
/*!*****************************************!*\
  !*** ./src/server/queries/envelopes.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getAllEnvelopeBalances: () => (/* binding */ getAllEnvelopeBalances),\n/* harmony export */   getBlockedEnvelopeCoverage: () => (/* binding */ getBlockedEnvelopeCoverage),\n/* harmony export */   getEnvelopeCoverageAll: () => (/* binding */ getEnvelopeCoverageAll)\n/* harmony export */ });\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/prisma */ \"(action-browser)/./src/lib/prisma.ts\");\n\nasync function getAllEnvelopeBalances() {\n    // Only consider active envelopes for balances shown in the app (dashboard, lists)\n    const envs = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.envelope.findMany({\n        where: {\n            active: true\n        },\n        select: {\n            id: true,\n            name: true,\n            protected: true,\n            active: true,\n            emoji: true,\n            budgetTarget: true\n        }\n    });\n    const dist = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.transactionAllocation.groupBy({\n        by: [\n            \"envelopeId\"\n        ],\n        _sum: {\n            amount: true\n        },\n        where: {\n            transaction: {\n                kind: \"DIST\"\n            }\n        }\n    });\n    const outs = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.transactionAllocation.groupBy({\n        by: [\n            \"envelopeId\"\n        ],\n        _sum: {\n            amount: true\n        },\n        where: {\n            transaction: {\n                kind: \"OUT\"\n            }\n        }\n    });\n    const mapD = new Map(dist.map((d)=>[\n            d.envelopeId,\n            d._sum.amount ?? 0\n        ]));\n    const mapO = new Map(outs.map((o)=>[\n            o.envelopeId,\n            o._sum.amount ?? 0\n        ]));\n    return envs.map((e)=>{\n        const inflow = mapD.get(e.id) ?? 0, outflow = mapO.get(e.id) ?? 0;\n        const total = typeof e.budgetTarget === 'number' ? e.budgetTarget : inflow;\n        const balance = total - outflow;\n        return {\n            envelopeId: e.id,\n            name: e.name,\n            protected: e.protected,\n            active: e.active,\n            emoji: e.emoji ?? null,\n            budgetTarget: e.budgetTarget ?? null,\n            inflow,\n            outflow,\n            balance\n        };\n    });\n}\n// Retourne la couverture (en mois) des enveloppes classées \"blocked\" ou protégées.\nasync function getBlockedEnvelopeCoverage() {\n    const now = new Date();\n    const daysWindow = 90; // use last 90 days to compute average\n    const since = new Date(now.getTime() - daysWindow * 24 * 3600 * 1000);\n    const envs = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.envelope.findMany({\n        where: {\n            active: true,\n            OR: [\n                {\n                    protected: true\n                },\n                {\n                    classification: 'blocked'\n                }\n            ]\n        },\n        select: {\n            id: true,\n            name: true,\n            emoji: true,\n            budgetTarget: true\n        }\n    });\n    if (envs.length === 0) return [];\n    const ids = envs.map((e)=>e.id);\n    // sum of OUT amounts over the window\n    const outs = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.transactionAllocation.groupBy({\n        by: [\n            'envelopeId'\n        ],\n        where: {\n            envelopeId: {\n                in: ids\n            },\n            transaction: {\n                kind: 'OUT',\n                at: {\n                    gte: since\n                }\n            }\n        },\n        _sum: {\n            amount: true\n        }\n    });\n    const outMap = new Map(outs.map((o)=>[\n            o.envelopeId,\n            o._sum.amount ?? 0\n        ]));\n    // current balances using existing helper logic: inflow/outflow all-time\n    const dist = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.transactionAllocation.groupBy({\n        by: [\n            'envelopeId'\n        ],\n        where: {\n            envelopeId: {\n                in: ids\n            },\n            transaction: {\n                kind: 'DIST'\n            }\n        },\n        _sum: {\n            amount: true\n        }\n    });\n    const outsAll = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.transactionAllocation.groupBy({\n        by: [\n            'envelopeId'\n        ],\n        where: {\n            envelopeId: {\n                in: ids\n            },\n            transaction: {\n                kind: 'OUT'\n            }\n        },\n        _sum: {\n            amount: true\n        }\n    });\n    const distMap = new Map(dist.map((d)=>[\n            d.envelopeId,\n            d._sum.amount ?? 0\n        ]));\n    const outsAllMap = new Map(outsAll.map((o)=>[\n            o.envelopeId,\n            o._sum.amount ?? 0\n        ]));\n    const res = envs.map((e)=>{\n        const allocated = distMap.get(e.id) ?? 0;\n        const spentAll = outsAllMap.get(e.id) ?? 0;\n        const balance = (typeof e.budgetTarget === 'number' ? e.budgetTarget : allocated) - spentAll;\n        const outLast90 = outMap.get(e.id) ?? 0;\n        const avgMonthly = outLast90 / daysWindow * 30; // approximate month\n        const months = avgMonthly > 0 ? Number((balance / avgMonthly).toFixed(1)) : balance > 0 ? Infinity : 0;\n        return {\n            envelopeId: e.id,\n            name: e.name,\n            emoji: e.emoji ?? null,\n            balance,\n            avgMonthly: Math.round(avgMonthly),\n            monthsCoverage: months\n        };\n    });\n    return res;\n}\n// Retourne la couverture (en mois) pour toutes les enveloppes actives.\nasync function getEnvelopeCoverageAll(options) {\n    const daysWindow = options?.daysWindow ?? 90;\n    const now = new Date();\n    const since = new Date(now.getTime() - daysWindow * 24 * 3600 * 1000);\n    const envs = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.envelope.findMany({\n        where: {\n            active: true\n        },\n        select: {\n            id: true,\n            name: true,\n            emoji: true,\n            budgetTarget: true\n        }\n    });\n    if (envs.length === 0) return [];\n    const ids = envs.map((e)=>e.id);\n    const outs = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.transactionAllocation.groupBy({\n        by: [\n            'envelopeId'\n        ],\n        where: {\n            envelopeId: {\n                in: ids\n            },\n            transaction: {\n                kind: 'OUT',\n                at: {\n                    gte: since\n                }\n            }\n        },\n        _sum: {\n            amount: true\n        }\n    });\n    const outMap = new Map(outs.map((o)=>[\n            o.envelopeId,\n            o._sum.amount ?? 0\n        ]));\n    const dist = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.transactionAllocation.groupBy({\n        by: [\n            'envelopeId'\n        ],\n        where: {\n            envelopeId: {\n                in: ids\n            },\n            transaction: {\n                kind: 'DIST'\n            }\n        },\n        _sum: {\n            amount: true\n        }\n    });\n    const outsAll = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.transactionAllocation.groupBy({\n        by: [\n            'envelopeId'\n        ],\n        where: {\n            envelopeId: {\n                in: ids\n            },\n            transaction: {\n                kind: 'OUT'\n            }\n        },\n        _sum: {\n            amount: true\n        }\n    });\n    const distMap = new Map(dist.map((d)=>[\n            d.envelopeId,\n            d._sum.amount ?? 0\n        ]));\n    const outsAllMap = new Map(outsAll.map((o)=>[\n            o.envelopeId,\n            o._sum.amount ?? 0\n        ]));\n    const res = envs.map((e)=>{\n        const allocated = distMap.get(e.id) ?? 0;\n        const spentAll = outsAllMap.get(e.id) ?? 0;\n        const balance = (typeof e.budgetTarget === 'number' ? e.budgetTarget : allocated) - spentAll;\n        const outLast = outMap.get(e.id) ?? 0;\n        const avgMonthly = outLast / daysWindow * 30;\n        const months = avgMonthly > 0 ? Number((balance / avgMonthly).toFixed(1)) : balance > 0 ? Infinity : 0;\n        return {\n            envelopeId: e.id,\n            name: e.name,\n            emoji: e.emoji ?? null,\n            balance,\n            avgMonthly: Math.round(avgMonthly),\n            monthsCoverage: months\n        };\n    });\n    return res;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL3NyYy9zZXJ2ZXIvcXVlcmllcy9lbnZlbG9wZXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFzQztBQUMvQixlQUFlQztJQUNwQixrRkFBa0Y7SUFDbEYsTUFBTUMsT0FBSyxNQUFNRiwrQ0FBTUEsQ0FBQ0csUUFBUSxDQUFDQyxRQUFRLENBQUM7UUFBRUMsT0FBTztZQUFFQyxRQUFRO1FBQUs7UUFBR0MsUUFBTztZQUFDQyxJQUFHO1lBQUtDLE1BQUs7WUFBS0MsV0FBVTtZQUFLSixRQUFPO1lBQU1LLE9BQU07WUFBTUMsY0FBYTtRQUFJO0lBQUM7SUFDekosTUFBTUMsT0FBSyxNQUFNYiwrQ0FBTUEsQ0FBQ2MscUJBQXFCLENBQUNDLE9BQU8sQ0FBQztRQUFDQyxJQUFHO1lBQUM7U0FBYTtRQUFFQyxNQUFLO1lBQUNDLFFBQU87UUFBSTtRQUFHYixPQUFNO1lBQUNjLGFBQVk7Z0JBQUNDLE1BQUs7WUFBTTtRQUFDO0lBQUM7SUFDL0gsTUFBTUMsT0FBSyxNQUFNckIsK0NBQU1BLENBQUNjLHFCQUFxQixDQUFDQyxPQUFPLENBQUM7UUFBQ0MsSUFBRztZQUFDO1NBQWE7UUFBRUMsTUFBSztZQUFDQyxRQUFPO1FBQUk7UUFBR2IsT0FBTTtZQUFDYyxhQUFZO2dCQUFDQyxNQUFLO1lBQUs7UUFBQztJQUFDO0lBQzlILE1BQU1FLE9BQUssSUFBSUMsSUFBSVYsS0FBS1csR0FBRyxDQUFDQyxDQUFBQSxJQUFHO1lBQUNBLEVBQUVDLFVBQVU7WUFBRUQsRUFBRVIsSUFBSSxDQUFDQyxNQUFNLElBQUU7U0FBRTtJQUFJLE1BQU1TLE9BQUssSUFBSUosSUFBSUYsS0FBS0csR0FBRyxDQUFDSSxDQUFBQSxJQUFHO1lBQUNBLEVBQUVGLFVBQVU7WUFBRUUsRUFBRVgsSUFBSSxDQUFDQyxNQUFNLElBQUU7U0FBRTtJQUNsSSxPQUFPaEIsS0FBS3NCLEdBQUcsQ0FBQ0ssQ0FBQUE7UUFBSyxNQUFNQyxTQUFPUixLQUFLUyxHQUFHLENBQUNG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LElBQUksQ0FBQ0MsTUFBTSxJQUFJO1NBQUU7SUFDdEUsTUFBTWlDLGFBQWEsSUFBSTVCLElBQUkwQixRQUFRekIsR0FBRyxDQUFDSSxDQUFBQSxJQUFHO1lBQUNBLEVBQUVGLFVBQVU7WUFBRUUsRUFBRVgsSUFBSSxDQUFDQyxNQUFNLElBQUk7U0FBRTtJQUU1RSxNQUFNa0MsTUFBTWxELEtBQUtzQixHQUFHLENBQUNLLENBQUFBO1FBQ25CLE1BQU13QixZQUFZSCxRQUFRbkIsR0FBRyxDQUFDRixFQUFFckIsRUFBRSxLQUFLO1FBQ3ZDLE1BQU04QyxXQUFXSCxXQUFXcEIsR0FBRyxDQUFDRixFQUFFckIsRUFBRSxLQUFLO1FBQ3pDLE1BQU0wQixVQUFVLENBQUMsT0FBT0wsRUFBRWpCLFlBQVksS0FBSyxXQUFXaUIsRUFBRWpCLFlBQVksR0FBR3lDLFNBQVEsSUFBS0M7UUFDcEYsTUFBTVksVUFBVWxCLE9BQU9qQixHQUFHLENBQUNGLEVBQUVyQixFQUFFLEtBQUs7UUFDcEMsTUFBTWdELGFBQWFVLFVBQVU1QixhQUFhO1FBQzFDLE1BQU1tQixTQUFTRCxhQUFhLElBQUlFLE9BQU8sQ0FBQ3hCLFVBQVVzQixVQUFTLEVBQUdHLE9BQU8sQ0FBQyxNQUFPekIsVUFBVSxJQUFJMEIsV0FBVztRQUN0RyxPQUFPO1lBQUVsQyxZQUFZRyxFQUFFckIsRUFBRTtZQUFFQyxNQUFNb0IsRUFBRXBCLElBQUk7WUFBRUUsT0FBT2tCLEVBQUVsQixLQUFLLElBQUk7WUFBTXVCO1lBQVNzQixZQUFZSyxLQUFLQyxLQUFLLENBQUNOO1lBQWFPLGdCQUFnQk47UUFBTztJQUN2STtJQUVBLE9BQU9MO0FBQ1QiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcQkMyNDFcXE11c2ljXFxmaW5hbmNlLWFwcC12MS1tYWluXFxmaW5hbmNlLWFwcC12MS1tYWluXFxzcmNcXHNlcnZlclxccXVlcmllc1xcZW52ZWxvcGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHByaXNtYSB9IGZyb20gXCJAL2xpYi9wcmlzbWFcIjtcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbGxFbnZlbG9wZUJhbGFuY2VzKCl7XG4gIC8vIE9ubHkgY29uc2lkZXIgYWN0aXZlIGVudmVsb3BlcyBmb3IgYmFsYW5jZXMgc2hvd24gaW4gdGhlIGFwcCAoZGFzaGJvYXJkLCBsaXN0cylcbiAgY29uc3QgZW52cz1hd2FpdCBwcmlzbWEuZW52ZWxvcGUuZmluZE1hbnkoeyB3aGVyZTogeyBhY3RpdmU6IHRydWUgfSwgc2VsZWN0OntpZDp0cnVlLG5hbWU6dHJ1ZSxwcm90ZWN0ZWQ6dHJ1ZSxhY3RpdmU6dHJ1ZSwgZW1vamk6dHJ1ZSwgYnVkZ2V0VGFyZ2V0OnRydWV9fSk7XG4gIGNvbnN0IGRpc3Q9YXdhaXQgcHJpc21hLnRyYW5zYWN0aW9uQWxsb2NhdGlvbi5ncm91cEJ5KHtieTpbXCJlbnZlbG9wZUlkXCJdLCBfc3VtOnthbW91bnQ6dHJ1ZX0sIHdoZXJlOnt0cmFuc2FjdGlvbjp7a2luZDpcIkRJU1RcIn19fSk7XG4gIGNvbnN0IG91dHM9YXdhaXQgcHJpc21hLnRyYW5zYWN0aW9uQWxsb2NhdGlvbi5ncm91cEJ5KHtieTpbXCJlbnZlbG9wZUlkXCJdLCBfc3VtOnthbW91bnQ6dHJ1ZX0sIHdoZXJlOnt0cmFuc2FjdGlvbjp7a2luZDpcIk9VVFwifX19KTtcbiAgY29uc3QgbWFwRD1uZXcgTWFwKGRpc3QubWFwKGQ9PltkLmVudmVsb3BlSWQsIGQuX3N1bS5hbW91bnQ/PzBdKSk7IGNvbnN0IG1hcE89bmV3IE1hcChvdXRzLm1hcChvPT5bby5lbnZlbG9wZUlkLCBvLl9zdW0uYW1vdW50Pz8wXSkpO1xuICByZXR1cm4gZW52cy5tYXAoZT0+eyBjb25zdCBpbmZsb3c9bWFwRC5nZXQoZS5pZCk/PzAsIG91dGZsb3c9bWFwTy5nZXQoZS5pZCk/PzA7IGNvbnN0IHRvdGFsID0gdHlwZW9mIGUuYnVkZ2V0VGFyZ2V0ID09PSAnbnVtYmVyJyA/IGUuYnVkZ2V0VGFyZ2V0IDogaW5mbG93OyBjb25zdCBiYWxhbmNlID0gdG90YWwgLSBvdXRmbG93OyByZXR1cm4geyBlbnZlbG9wZUlkOmUuaWQsIG5hbWU6ZS5uYW1lLCBwcm90ZWN0ZWQ6ZS5wcm90ZWN0ZWQsIGFjdGl2ZTplLmFjdGl2ZSwgZW1vamk6IGUuZW1vamkgPz8gbnVsbCwgYnVkZ2V0VGFyZ2V0OiBlLmJ1ZGdldFRhcmdldCA/PyBudWxsLCBpbmZsb3csIG91dGZsb3csIGJhbGFuY2UgfTsgfSk7XG59XG5cbi8vIFJldG91cm5lIGxhIGNvdXZlcnR1cmUgKGVuIG1vaXMpIGRlcyBlbnZlbG9wcGVzIGNsYXNzw6llcyBcImJsb2NrZWRcIiBvdSBwcm90w6lnw6llcy5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRCbG9ja2VkRW52ZWxvcGVDb3ZlcmFnZSgpe1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICBjb25zdCBkYXlzV2luZG93ID0gOTA7IC8vIHVzZSBsYXN0IDkwIGRheXMgdG8gY29tcHV0ZSBhdmVyYWdlXG4gIGNvbnN0IHNpbmNlID0gbmV3IERhdGUobm93LmdldFRpbWUoKSAtIGRheXNXaW5kb3cgKiAyNCAqIDM2MDAgKiAxMDAwKTtcblxuICBjb25zdCBlbnZzID0gYXdhaXQgcHJpc21hLmVudmVsb3BlLmZpbmRNYW55KHsgd2hlcmU6IHsgYWN0aXZlOiB0cnVlLCBPUjogW3sgcHJvdGVjdGVkOiB0cnVlIH0sIHsgY2xhc3NpZmljYXRpb246ICdibG9ja2VkJyB9XSB9LCBzZWxlY3Q6IHsgaWQ6dHJ1ZSwgbmFtZTp0cnVlLCBlbW9qaTp0cnVlLCBidWRnZXRUYXJnZXQ6dHJ1ZSB9IH0pO1xuICBpZihlbnZzLmxlbmd0aD09PTApIHJldHVybiBbXSBhcyBhbnlbXTtcblxuICBjb25zdCBpZHMgPSBlbnZzLm1hcChlPT5lLmlkKTtcblxuICAvLyBzdW0gb2YgT1VUIGFtb3VudHMgb3ZlciB0aGUgd2luZG93XG4gIGNvbnN0IG91dHMgPSBhd2FpdCBwcmlzbWEudHJhbnNhY3Rpb25BbGxvY2F0aW9uLmdyb3VwQnkoe1xuICAgIGJ5OiBbJ2VudmVsb3BlSWQnXSxcbiAgICB3aGVyZTogeyBlbnZlbG9wZUlkOiB7IGluOiBpZHMgfSwgdHJhbnNhY3Rpb246IHsga2luZDogJ09VVCcsIGF0OiB7IGd0ZTogc2luY2UgfSB9IH0sXG4gICAgX3N1bTogeyBhbW91bnQ6IHRydWUgfVxuICB9KTtcblxuICBjb25zdCBvdXRNYXAgPSBuZXcgTWFwKG91dHMubWFwKG89PltvLmVudmVsb3BlSWQsIG8uX3N1bS5hbW91bnQgPz8gMF0pKTtcblxuICAvLyBjdXJyZW50IGJhbGFuY2VzIHVzaW5nIGV4aXN0aW5nIGhlbHBlciBsb2dpYzogaW5mbG93L291dGZsb3cgYWxsLXRpbWVcbiAgY29uc3QgZGlzdCA9IGF3YWl0IHByaXNtYS50cmFuc2FjdGlvbkFsbG9jYXRpb24uZ3JvdXBCeSh7IGJ5OiBbJ2VudmVsb3BlSWQnXSwgd2hlcmU6IHsgZW52ZWxvcGVJZDogeyBpbjogaWRzIH0sIHRyYW5zYWN0aW9uOiB7IGtpbmQ6ICdESVNUJyB9IH0sIF9zdW06IHsgYW1vdW50OiB0cnVlIH0gfSk7XG4gIGNvbnN0IG91dHNBbGwgPSBhd2FpdCBwcmlzbWEudHJhbnNhY3Rpb25BbGxvY2F0aW9uLmdyb3VwQnkoeyBieTogWydlbnZlbG9wZUlkJ10sIHdoZXJlOiB7IGVudmVsb3BlSWQ6IHsgaW46IGlkcyB9LCB0cmFuc2FjdGlvbjogeyBraW5kOiAnT1VUJyB9IH0sIF9zdW06IHsgYW1vdW50OiB0cnVlIH0gfSk7XG4gIGNvbnN0IGRpc3RNYXAgPSBuZXcgTWFwKGRpc3QubWFwKGQ9PltkLmVudmVsb3BlSWQsIGQuX3N1bS5hbW91bnQgPz8gMF0pKTtcbiAgY29uc3Qgb3V0c0FsbE1hcCA9IG5ldyBNYXAob3V0c0FsbC5tYXAobz0+W28uZW52ZWxvcGVJZCwgby5fc3VtLmFtb3VudCA/PyAwXSkpO1xuXG4gIGNvbnN0IHJlcyA9IGVudnMubWFwKGU9PntcbiAgICBjb25zdCBhbGxvY2F0ZWQgPSBkaXN0TWFwLmdldChlLmlkKSA/PyAwO1xuICAgIGNvbnN0IHNwZW50QWxsID0gb3V0c0FsbE1hcC5nZXQoZS5pZCkgPz8gMDtcbiAgICBjb25zdCBiYWxhbmNlID0gKHR5cGVvZiBlLmJ1ZGdldFRhcmdldCA9PT0gJ251bWJlcicgPyBlLmJ1ZGdldFRhcmdldCA6IGFsbG9jYXRlZCkgLSBzcGVudEFsbDtcbiAgICBjb25zdCBvdXRMYXN0OTAgPSBvdXRNYXAuZ2V0KGUuaWQpID8/IDA7XG4gICAgY29uc3QgYXZnTW9udGhseSA9IG91dExhc3Q5MCAvIGRheXNXaW5kb3cgKiAzMDsgLy8gYXBwcm94aW1hdGUgbW9udGhcbiAgICBjb25zdCBtb250aHMgPSBhdmdNb250aGx5ID4gMCA/IE51bWJlcigoYmFsYW5jZSAvIGF2Z01vbnRobHkpLnRvRml4ZWQoMSkpIDogKGJhbGFuY2UgPiAwID8gSW5maW5pdHkgOiAwKTtcbiAgICByZXR1cm4geyBlbnZlbG9wZUlkOiBlLmlkLCBuYW1lOiBlLm5hbWUsIGVtb2ppOiBlLmVtb2ppID8/IG51bGwsIGJhbGFuY2UsIGF2Z01vbnRobHk6IE1hdGgucm91bmQoYXZnTW9udGhseSksIG1vbnRoc0NvdmVyYWdlOiBtb250aHMgfTtcbiAgfSk7XG5cbiAgcmV0dXJuIHJlcztcbn1cblxuLy8gUmV0b3VybmUgbGEgY291dmVydHVyZSAoZW4gbW9pcykgcG91ciB0b3V0ZXMgbGVzIGVudmVsb3BwZXMgYWN0aXZlcy5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRFbnZlbG9wZUNvdmVyYWdlQWxsKG9wdGlvbnM/OiB7IGRheXNXaW5kb3c/OiBudW1iZXIgfSl7XG4gIGNvbnN0IGRheXNXaW5kb3cgPSBvcHRpb25zPy5kYXlzV2luZG93ID8/IDkwO1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICBjb25zdCBzaW5jZSA9IG5ldyBEYXRlKG5vdy5nZXRUaW1lKCkgLSBkYXlzV2luZG93ICogMjQgKiAzNjAwICogMTAwMCk7XG5cbiAgY29uc3QgZW52cyA9IGF3YWl0IHByaXNtYS5lbnZlbG9wZS5maW5kTWFueSh7IHdoZXJlOiB7IGFjdGl2ZTogdHJ1ZSB9LCBzZWxlY3Q6IHsgaWQ6dHJ1ZSwgbmFtZTp0cnVlLCBlbW9qaTp0cnVlLCBidWRnZXRUYXJnZXQ6dHJ1ZSB9IH0pO1xuICBpZihlbnZzLmxlbmd0aD09PTApIHJldHVybiBbXSBhcyBhbnlbXTtcblxuICBjb25zdCBpZHMgPSBlbnZzLm1hcChlPT5lLmlkKTtcblxuICBjb25zdCBvdXRzID0gYXdhaXQgcHJpc21hLnRyYW5zYWN0aW9uQWxsb2NhdGlvbi5ncm91cEJ5KHtcbiAgICBieTogWydlbnZlbG9wZUlkJ10sXG4gICAgd2hlcmU6IHsgZW52ZWxvcGVJZDogeyBpbjogaWRzIH0sIHRyYW5zYWN0aW9uOiB7IGtpbmQ6ICdPVVQnLCBhdDogeyBndGU6IHNpbmNlIH0gfSB9LFxuICAgIF9zdW06IHsgYW1vdW50OiB0cnVlIH1cbiAgfSk7XG5cbiAgY29uc3Qgb3V0TWFwID0gbmV3IE1hcChvdXRzLm1hcChvPT5bby5lbnZlbG9wZUlkLCBvLl9zdW0uYW1vdW50ID8/IDBdKSk7XG5cbiAgY29uc3QgZGlzdCA9IGF3YWl0IHByaXNtYS50cmFuc2FjdGlvbkFsbG9jYXRpb24uZ3JvdXBCeSh7IGJ5OiBbJ2VudmVsb3BlSWQnXSwgd2hlcmU6IHsgZW52ZWxvcGVJZDogeyBpbjogaWRzIH0sIHRyYW5zYWN0aW9uOiB7IGtpbmQ6ICdESVNUJyB9IH0sIF9zdW06IHsgYW1vdW50OiB0cnVlIH0gfSk7XG4gIGNvbnN0IG91dHNBbGwgPSBhd2FpdCBwcmlzbWEudHJhbnNhY3Rpb25BbGxvY2F0aW9uLmdyb3VwQnkoeyBieTogWydlbnZlbG9wZUlkJ10sIHdoZXJlOiB7IGVudmVsb3BlSWQ6IHsgaW46IGlkcyB9LCB0cmFuc2FjdGlvbjogeyBraW5kOiAnT1VUJyB9IH0sIF9zdW06IHsgYW1vdW50OiB0cnVlIH0gfSk7XG4gIGNvbnN0IGRpc3RNYXAgPSBuZXcgTWFwKGRpc3QubWFwKGQ9PltkLmVudmVsb3BlSWQsIGQuX3N1bS5hbW91bnQgPz8gMF0pKTtcbiAgY29uc3Qgb3V0c0FsbE1hcCA9IG5ldyBNYXAob3V0c0FsbC5tYXAobz0+W28uZW52ZWxvcGVJZCwgby5fc3VtLmFtb3VudCA/PyAwXSkpO1xuXG4gIGNvbnN0IHJlcyA9IGVudnMubWFwKGU9PntcbiAgICBjb25zdCBhbGxvY2F0ZWQgPSBkaXN0TWFwLmdldChlLmlkKSA/PyAwO1xuICAgIGNvbnN0IHNwZW50QWxsID0gb3V0c0FsbE1hcC5nZXQoZS5pZCkgPz8gMDtcbiAgICBjb25zdCBiYWxhbmNlID0gKHR5cGVvZiBlLmJ1ZGdldFRhcmdldCA9PT0gJ251bWJlcicgPyBlLmJ1ZGdldFRhcmdldCA6IGFsbG9jYXRlZCkgLSBzcGVudEFsbDtcbiAgICBjb25zdCBvdXRMYXN0ID0gb3V0TWFwLmdldChlLmlkKSA/PyAwO1xuICAgIGNvbnN0IGF2Z01vbnRobHkgPSBvdXRMYXN0IC8gZGF5c1dpbmRvdyAqIDMwO1xuICAgIGNvbnN0IG1vbnRocyA9IGF2Z01vbnRobHkgPiAwID8gTnVtYmVyKChiYWxhbmNlIC8gYXZnTW9udGhseSkudG9GaXhlZCgxKSkgOiAoYmFsYW5jZSA+IDAgPyBJbmZpbml0eSA6IDApO1xuICAgIHJldHVybiB7IGVudmVsb3BlSWQ6IGUuaWQsIG5hbWU6IGUubmFtZSwgZW1vamk6IGUuZW1vamkgPz8gbnVsbCwgYmFsYW5jZSwgYXZnTW9udGhseTogTWF0aC5yb3VuZChhdmdNb250aGx5KSwgbW9udGhzQ292ZXJhZ2U6IG1vbnRocyB9O1xuICB9KTtcblxuICByZXR1cm4gcmVzO1xufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImdldEFsbEVudmVsb3BlQmFsYW5jZXMiLCJlbnZzIiwiZW52ZWxvcGUiLCJmaW5kTWFueSIsIndoZXJlIiwiYWN0aXZlIiwic2VsZWN0IiwiaWQiLCJuYW1lIiwicHJvdGVjdGVkIiwiZW1vamkiLCJidWRnZXRUYXJnZXQiLCJkaXN0IiwidHJhbnNhY3Rpb25BbGxvY2F0aW9uIiwiZ3JvdXBCeSIsImJ5IiwiX3N1bSIsImFtb3VudCIsInRyYW5zYWN0aW9uIiwia2luZCIsIm91dHMiLCJtYXBEIiwiTWFwIiwibWFwIiwiZCIsImVudmVsb3BlSWQiLCJtYXBPIiwibyIsImUiLCJpbmZsb3ciLCJnZXQiLCJvdXRmbG93IiwidG90YWwiLCJiYWxhbmNlIiwiZ2V0QmxvY2tlZEVudmVsb3BlQ292ZXJhZ2UiLCJub3ciLCJEYXRlIiwiZGF5c1dpbmRvdyIsInNpbmNlIiwiZ2V0VGltZSIsIk9SIiwiY2xhc3NpZmljYXRpb24iLCJsZW5ndGgiLCJpZHMiLCJpbiIsImF0IiwiZ3RlIiwib3V0TWFwIiwib3V0c0FsbCIsImRpc3RNYXAiLCJvdXRzQWxsTWFwIiwicmVzIiwiYWxsb2NhdGVkIiwic3BlbnRBbGwiLCJvdXRMYXN0OTAiLCJhdmdNb250aGx5IiwibW9udGhzIiwiTnVtYmVyIiwidG9GaXhlZCIsIkluZmluaXR5IiwiTWF0aCIsInJvdW5kIiwibW9udGhzQ292ZXJhZ2UiLCJnZXRFbnZlbG9wZUNvdmVyYWdlQWxsIiwib3B0aW9ucyIsIm91dExhc3QiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/./src/server/queries/envelopes.ts\n");

/***/ }),

/***/ "(action-browser)/./src/server/queries/ledger.ts":
/*!**************************************!*\
  !*** ./src/server/queries/ledger.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getDayTotals: () => (/* binding */ getDayTotals)\n/* harmony export */ });\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/prisma */ \"(action-browser)/./src/lib/prisma.ts\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"(action-browser)/./node_modules/.pnpm/next@15.0.3_@playwright+tes_c0fbebec67a33fb30e42c14d3a81a9d2/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);\n\n\nfunction startEnd(d) {\n    return {\n        start: new Date(d + \"T00:00:00.000Z\"),\n        end: new Date(d + \"T23:59:59.999Z\")\n    };\n}\nconst getDayTotals = (0,react__WEBPACK_IMPORTED_MODULE_1__.cache)(async (dateISO)=>{\n    const { start, end } = startEnd(dateISO);\n    const [i, o] = await Promise.all([\n        _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.transaction.aggregate({\n            _sum: {\n                amount: true\n            },\n            where: {\n                kind: \"IN\",\n                at: {\n                    gte: start,\n                    lte: end\n                }\n            }\n        }),\n        _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.transaction.aggregate({\n            _sum: {\n                amount: true\n            },\n            where: {\n                kind: \"OUT\",\n                at: {\n                    gte: start,\n                    lte: end\n                }\n            }\n        })\n    ]);\n    const _in = i._sum.amount ?? 0, _out = o._sum.amount ?? 0;\n    return {\n        in: _in,\n        out: _out,\n        onHand: _in - _out\n    };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL3NyYy9zZXJ2ZXIvcXVlcmllcy9sZWRnZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFzQztBQUErQjtBQUNyRSxTQUFTRSxTQUFTQyxDQUFRO0lBQUcsT0FBTztRQUFFQyxPQUFNLElBQUlDLEtBQUtGLElBQUU7UUFBbUJHLEtBQUksSUFBSUQsS0FBS0YsSUFBRTtJQUFrQjtBQUFHO0FBQ3ZHLE1BQU1JLGVBQWVOLDRDQUFLQSxDQUFDLE9BQU9PO0lBQ3ZDLE1BQU0sRUFBQ0osS0FBSyxFQUFDRSxHQUFHLEVBQUMsR0FBQ0osU0FBU007SUFDM0IsTUFBTSxDQUFDQyxHQUFFQyxFQUFFLEdBQUMsTUFBTUMsUUFBUUMsR0FBRyxDQUFDO1FBQzVCWiwrQ0FBTUEsQ0FBQ2EsV0FBVyxDQUFDQyxTQUFTLENBQUM7WUFBQ0MsTUFBSztnQkFBQ0MsUUFBTztZQUFJO1lBQUdDLE9BQU07Z0JBQUNDLE1BQUs7Z0JBQU1DLElBQUc7b0JBQUNDLEtBQUloQjtvQkFBTWlCLEtBQUlmO2dCQUFHO1lBQUM7UUFBQztRQUMzRk4sK0NBQU1BLENBQUNhLFdBQVcsQ0FBQ0MsU0FBUyxDQUFDO1lBQUNDLE1BQUs7Z0JBQUNDLFFBQU87WUFBSTtZQUFHQyxPQUFNO2dCQUFDQyxNQUFLO2dCQUFPQyxJQUFHO29CQUFDQyxLQUFJaEI7b0JBQU1pQixLQUFJZjtnQkFBRztZQUFDO1FBQUM7S0FDN0Y7SUFDRCxNQUFNZ0IsTUFBSWIsRUFBRU0sSUFBSSxDQUFDQyxNQUFNLElBQUUsR0FBR08sT0FBS2IsRUFBRUssSUFBSSxDQUFDQyxNQUFNLElBQUU7SUFBRyxPQUFPO1FBQUVRLElBQUdGO1FBQUtHLEtBQUlGO1FBQU1HLFFBQU9KLE1BQUlDO0lBQUs7QUFDaEcsR0FBRyIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxCQzI0MVxcTXVzaWNcXGZpbmFuY2UtYXBwLXYxLW1haW5cXGZpbmFuY2UtYXBwLXYxLW1haW5cXHNyY1xcc2VydmVyXFxxdWVyaWVzXFxsZWRnZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcHJpc21hIH0gZnJvbSBcIkAvbGliL3ByaXNtYVwiOyBpbXBvcnQgeyBjYWNoZSB9IGZyb20gXCJyZWFjdFwiO1xuZnVuY3Rpb24gc3RhcnRFbmQoZDpzdHJpbmcpeyByZXR1cm4geyBzdGFydDpuZXcgRGF0ZShkK1wiVDAwOjAwOjAwLjAwMFpcIiksIGVuZDpuZXcgRGF0ZShkK1wiVDIzOjU5OjU5Ljk5OVpcIikgfTsgfVxuZXhwb3J0IGNvbnN0IGdldERheVRvdGFscyA9IGNhY2hlKGFzeW5jIChkYXRlSVNPOnN0cmluZyk9PntcbiAgY29uc3Qge3N0YXJ0LGVuZH09c3RhcnRFbmQoZGF0ZUlTTyk7XG4gIGNvbnN0IFtpLG9dPWF3YWl0IFByb21pc2UuYWxsKFtcbiAgICBwcmlzbWEudHJhbnNhY3Rpb24uYWdncmVnYXRlKHtfc3VtOnthbW91bnQ6dHJ1ZX0sIHdoZXJlOntraW5kOlwiSU5cIiwgYXQ6e2d0ZTpzdGFydCxsdGU6ZW5kfX19KSxcbiAgICBwcmlzbWEudHJhbnNhY3Rpb24uYWdncmVnYXRlKHtfc3VtOnthbW91bnQ6dHJ1ZX0sIHdoZXJlOntraW5kOlwiT1VUXCIsIGF0OntndGU6c3RhcnQsbHRlOmVuZH19fSlcbiAgXSk7XG4gIGNvbnN0IF9pbj1pLl9zdW0uYW1vdW50Pz8wLCBfb3V0PW8uX3N1bS5hbW91bnQ/PzA7IHJldHVybiB7IGluOl9pbiwgb3V0Ol9vdXQsIG9uSGFuZDpfaW4tX291dCB9O1xufSk7XG4iXSwibmFtZXMiOlsicHJpc21hIiwiY2FjaGUiLCJzdGFydEVuZCIsImQiLCJzdGFydCIsIkRhdGUiLCJlbmQiLCJnZXREYXlUb3RhbHMiLCJkYXRlSVNPIiwiaSIsIm8iLCJQcm9taXNlIiwiYWxsIiwidHJhbnNhY3Rpb24iLCJhZ2dyZWdhdGUiLCJfc3VtIiwiYW1vdW50Iiwid2hlcmUiLCJraW5kIiwiYXQiLCJndGUiLCJsdGUiLCJfaW4iLCJfb3V0IiwiaW4iLCJvdXQiLCJvbkhhbmQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/./src/server/queries/ledger.ts\n");

/***/ }),

/***/ "(action-browser)/./src/server/queries/rules.ts":
/*!*************************************!*\
  !*** ./src/server/queries/rules.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   computeProposal: () => (/* binding */ computeProposal),\n/* harmony export */   getActiveDistributionRule: () => (/* binding */ getActiveDistributionRule)\n/* harmony export */ });\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/prisma */ \"(action-browser)/./src/lib/prisma.ts\");\n\nasync function getActiveDistributionRule() {\n    const now = new Date();\n    return _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.distributionRule.findFirst({\n        where: {\n            startsAt: {\n                lte: now\n            },\n            OR: [\n                {\n                    endsAt: null\n                },\n                {\n                    endsAt: {\n                        gt: now\n                    }\n                }\n            ]\n        },\n        include: {\n            items: {\n                include: {\n                    envelope: true\n                }\n            }\n        },\n        orderBy: {\n            startsAt: \"desc\"\n        }\n    });\n}\nfunction computeProposal(onHand, items) {\n    const res = items.map((i)=>({\n            envelopeId: i.envelopeId,\n            name: i.envelopeName,\n            percent: i.percent,\n            suggestedAmount: Math.floor(onHand * i.percent / 100)\n        }));\n    const sum = res.reduce((s, r)=>s + r.suggestedAmount, 0);\n    let diff = onHand - sum, idx = 0;\n    while(diff > 0 && res.length){\n        res[idx % res.length].suggestedAmount++;\n        idx++;\n        diff--;\n    }\n    return res;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL3NyYy9zZXJ2ZXIvcXVlcmllcy9ydWxlcy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBc0M7QUFDL0IsZUFBZUM7SUFDcEIsTUFBTUMsTUFBSSxJQUFJQztJQUNkLE9BQU9ILCtDQUFNQSxDQUFDSSxnQkFBZ0IsQ0FBQ0MsU0FBUyxDQUFDO1FBQUVDLE9BQU07WUFBRUMsVUFBUztnQkFBQ0MsS0FBSU47WUFBRztZQUFHTyxJQUFHO2dCQUFDO29CQUFDQyxRQUFPO2dCQUFJO2dCQUFFO29CQUFDQSxRQUFPO3dCQUFDQyxJQUFHVDtvQkFBRztnQkFBQzthQUFFO1FBQUM7UUFBR1UsU0FBUTtZQUFFQyxPQUFNO2dCQUFFRCxTQUFRO29CQUFFRSxVQUFTO2dCQUFLO1lBQUU7UUFBRTtRQUFHQyxTQUFRO1lBQUVSLFVBQVM7UUFBTztJQUFFO0FBQzlMO0FBQ08sU0FBU1MsZ0JBQWdCQyxNQUFhLEVBQUVKLEtBQThEO0lBQzNHLE1BQU1LLE1BQUlMLE1BQU1NLEdBQUcsQ0FBQ0MsQ0FBQUEsSUFBSTtZQUFFQyxZQUFXRCxFQUFFQyxVQUFVO1lBQUVDLE1BQUtGLEVBQUVHLFlBQVk7WUFBRUMsU0FBUUosRUFBRUksT0FBTztZQUFFQyxpQkFBaUJDLEtBQUtDLEtBQUssQ0FBQ1YsU0FBT0csRUFBRUksT0FBTyxHQUFDO1FBQUs7SUFDN0ksTUFBTUksTUFBSVYsSUFBSVcsTUFBTSxDQUFDLENBQUNDLEdBQUVDLElBQUlELElBQUVDLEVBQUVOLGVBQWUsRUFBQztJQUFJLElBQUlPLE9BQUtmLFNBQU9XLEtBQUtLLE1BQUk7SUFDN0UsTUFBTUQsT0FBSyxLQUFLZCxJQUFJZ0IsTUFBTSxDQUFDO1FBQUVoQixHQUFHLENBQUNlLE1BQUlmLElBQUlnQixNQUFNLENBQUMsQ0FBQ1QsZUFBZTtRQUFJUTtRQUFPRDtJQUFRO0lBQ25GLE9BQU9kO0FBQ1QiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcQkMyNDFcXE11c2ljXFxmaW5hbmNlLWFwcC12MS1tYWluXFxmaW5hbmNlLWFwcC12MS1tYWluXFxzcmNcXHNlcnZlclxccXVlcmllc1xccnVsZXMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcHJpc21hIH0gZnJvbSBcIkAvbGliL3ByaXNtYVwiO1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEFjdGl2ZURpc3RyaWJ1dGlvblJ1bGUoKXtcbiAgY29uc3Qgbm93PW5ldyBEYXRlKCk7XG4gIHJldHVybiBwcmlzbWEuZGlzdHJpYnV0aW9uUnVsZS5maW5kRmlyc3QoeyB3aGVyZTp7IHN0YXJ0c0F0OntsdGU6bm93fSwgT1I6W3tlbmRzQXQ6bnVsbH0se2VuZHNBdDp7Z3Q6bm93fX1dIH0sIGluY2x1ZGU6eyBpdGVtczp7IGluY2x1ZGU6eyBlbnZlbG9wZTp0cnVlIH0gfSB9LCBvcmRlckJ5Onsgc3RhcnRzQXQ6XCJkZXNjXCIgfSB9KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjb21wdXRlUHJvcG9zYWwob25IYW5kOm51bWJlciwgaXRlbXM6e2VudmVsb3BlSWQ6c3RyaW5nO3BlcmNlbnQ6bnVtYmVyO2VudmVsb3BlTmFtZTpzdHJpbmd9W10pe1xuICBjb25zdCByZXM9aXRlbXMubWFwKGk9Pih7IGVudmVsb3BlSWQ6aS5lbnZlbG9wZUlkLCBuYW1lOmkuZW52ZWxvcGVOYW1lLCBwZXJjZW50OmkucGVyY2VudCwgc3VnZ2VzdGVkQW1vdW50OiBNYXRoLmZsb29yKG9uSGFuZCppLnBlcmNlbnQvMTAwKSB9KSk7XG4gIGNvbnN0IHN1bT1yZXMucmVkdWNlKChzLHIpPT5zK3Iuc3VnZ2VzdGVkQW1vdW50LDApOyBsZXQgZGlmZj1vbkhhbmQtc3VtLCBpZHg9MDtcbiAgd2hpbGUoZGlmZj4wICYmIHJlcy5sZW5ndGgpeyByZXNbaWR4JXJlcy5sZW5ndGhdLnN1Z2dlc3RlZEFtb3VudCsrOyBpZHgrKzsgZGlmZi0tOyB9XG4gIHJldHVybiByZXM7XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwiZ2V0QWN0aXZlRGlzdHJpYnV0aW9uUnVsZSIsIm5vdyIsIkRhdGUiLCJkaXN0cmlidXRpb25SdWxlIiwiZmluZEZpcnN0Iiwid2hlcmUiLCJzdGFydHNBdCIsImx0ZSIsIk9SIiwiZW5kc0F0IiwiZ3QiLCJpbmNsdWRlIiwiaXRlbXMiLCJlbnZlbG9wZSIsIm9yZGVyQnkiLCJjb21wdXRlUHJvcG9zYWwiLCJvbkhhbmQiLCJyZXMiLCJtYXAiLCJpIiwiZW52ZWxvcGVJZCIsIm5hbWUiLCJlbnZlbG9wZU5hbWUiLCJwZXJjZW50Iiwic3VnZ2VzdGVkQW1vdW50IiwiTWF0aCIsImZsb29yIiwic3VtIiwicmVkdWNlIiwicyIsInIiLCJkaWZmIiwiaWR4IiwibGVuZ3RoIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(action-browser)/./src/server/queries/rules.ts\n");

/***/ }),

/***/ "(action-browser)/./src/server/validators/distribution.ts":
/*!***********************************************!*\
  !*** ./src/server/validators/distribution.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DistributeSchema: () => (/* binding */ DistributeSchema),\n/* harmony export */   GetDaySummarySchema: () => (/* binding */ GetDaySummarySchema),\n/* harmony export */   GetDistributionProposalSchema: () => (/* binding */ GetDistributionProposalSchema),\n/* harmony export */   ReconcileSchema: () => (/* binding */ ReconcileSchema)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(action-browser)/./node_modules/.pnpm/zod@3.23.8/node_modules/zod/lib/index.mjs\");\n\nconst GetDaySummarySchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    date: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/)\n});\nconst DistributeSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    onHand: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().nonnegative(),\n    rows: zod__WEBPACK_IMPORTED_MODULE_0__.z.array(zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n        envelopeId: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1),\n        percent: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().min(0).max(100).optional(),\n        amount: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().nonnegative().optional()\n    })).min(1),\n    allowOverride: zod__WEBPACK_IMPORTED_MODULE_0__.z.boolean().optional(),\n    overrideReason: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().max(500).optional()\n}).refine((v)=>v.rows.reduce((s, r)=>s + (r.amount ?? 0), 0) <= v.onHand, \"Montant distribué > montant en main\").refine((v)=>!v.allowOverride || v.overrideReason && v.overrideReason.trim().length >= 5, \"overrideReason (≥ 5 caractères) requis si allowOverride = true\");\nconst ReconcileSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    declaredOnHand: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().nonnegative()\n});\nconst GetDistributionProposalSchema = GetDaySummarySchema;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL3NyYy9zZXJ2ZXIvdmFsaWRhdG9ycy9kaXN0cmlidXRpb24udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBd0I7QUFDakIsTUFBTUMsc0JBQXNCRCxrQ0FBQ0EsQ0FBQ0UsTUFBTSxDQUFDO0lBQUVDLE1BQU1ILGtDQUFDQSxDQUFDSSxNQUFNLEdBQUdDLEtBQUssQ0FBQztBQUF1QixHQUFHO0FBRXhGLE1BQU1DLG1CQUFtQk4sa0NBQUNBLENBQUNFLE1BQU0sQ0FBQztJQUN2Q0ssUUFBUVAsa0NBQUNBLENBQUNRLE1BQU0sR0FBR0MsR0FBRyxHQUFHQyxXQUFXO0lBQ3BDQyxNQUFNWCxrQ0FBQ0EsQ0FBQ1ksS0FBSyxDQUFDWixrQ0FBQ0EsQ0FBQ0UsTUFBTSxDQUFDO1FBQUVXLFlBQVliLGtDQUFDQSxDQUFDSSxNQUFNLEdBQUdVLEdBQUcsQ0FBQztRQUFJQyxTQUFTZixrQ0FBQ0EsQ0FBQ1EsTUFBTSxHQUFHQyxHQUFHLEdBQUdLLEdBQUcsQ0FBQyxHQUFHRSxHQUFHLENBQUMsS0FBS0MsUUFBUTtRQUFJQyxRQUFRbEIsa0NBQUNBLENBQUNRLE1BQU0sR0FBR0MsR0FBRyxHQUFHQyxXQUFXLEdBQUdPLFFBQVE7SUFBRyxJQUFJSCxHQUFHLENBQUM7SUFDeEtLLGVBQWVuQixrQ0FBQ0EsQ0FBQ29CLE9BQU8sR0FBR0gsUUFBUTtJQUFJSSxnQkFBZ0JyQixrQ0FBQ0EsQ0FBQ0ksTUFBTSxHQUFHWSxHQUFHLENBQUMsS0FBS0MsUUFBUTtBQUNyRixHQUFHSyxNQUFNLENBQUNDLENBQUFBLElBQUlBLEVBQUVaLElBQUksQ0FBQ2EsTUFBTSxDQUFDLENBQUNDLEdBQUVDLElBQUlELElBQUdDLENBQUFBLEVBQUVSLE1BQU0sSUFBRSxJQUFHLE1BQU1LLEVBQUVoQixNQUFNLEVBQUUsdUNBQ2pFZSxNQUFNLENBQUNDLENBQUFBLElBQUksQ0FBQ0EsRUFBRUosYUFBYSxJQUFLSSxFQUFFRixjQUFjLElBQUlFLEVBQUVGLGNBQWMsQ0FBQ00sSUFBSSxHQUFHQyxNQUFNLElBQUUsR0FBSSxrRUFBa0U7QUFFckosTUFBTUMsa0JBQWtCN0Isa0NBQUNBLENBQUNFLE1BQU0sQ0FBQztJQUFFNEIsZ0JBQWdCOUIsa0NBQUNBLENBQUNRLE1BQU0sR0FBR0MsR0FBRyxHQUFHQyxXQUFXO0FBQUcsR0FBRztBQUVyRixNQUFNcUIsZ0NBQWdDOUIsb0JBQW9CIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXEJDMjQxXFxNdXNpY1xcZmluYW5jZS1hcHAtdjEtbWFpblxcZmluYW5jZS1hcHAtdjEtbWFpblxcc3JjXFxzZXJ2ZXJcXHZhbGlkYXRvcnNcXGRpc3RyaWJ1dGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB6IH0gZnJvbSBcInpvZFwiO1xuZXhwb3J0IGNvbnN0IEdldERheVN1bW1hcnlTY2hlbWEgPSB6Lm9iamVjdCh7IGRhdGU6IHouc3RyaW5nKCkucmVnZXgoL15cXGR7NH0tXFxkezJ9LVxcZHsyfSQvKSB9KTtcbmV4cG9ydCB0eXBlIEdldERheVN1bW1hcnlJbnB1dCA9IHouaW5mZXI8dHlwZW9mIEdldERheVN1bW1hcnlTY2hlbWE+O1xuZXhwb3J0IGNvbnN0IERpc3RyaWJ1dGVTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIG9uSGFuZDogei5udW1iZXIoKS5pbnQoKS5ub25uZWdhdGl2ZSgpLFxuICByb3dzOiB6LmFycmF5KHoub2JqZWN0KHsgZW52ZWxvcGVJZDogei5zdHJpbmcoKS5taW4oMSksIHBlcmNlbnQ6IHoubnVtYmVyKCkuaW50KCkubWluKDApLm1heCgxMDApLm9wdGlvbmFsKCksIGFtb3VudDogei5udW1iZXIoKS5pbnQoKS5ub25uZWdhdGl2ZSgpLm9wdGlvbmFsKCkgfSkpLm1pbigxKSxcbiAgYWxsb3dPdmVycmlkZTogei5ib29sZWFuKCkub3B0aW9uYWwoKSwgb3ZlcnJpZGVSZWFzb246IHouc3RyaW5nKCkubWF4KDUwMCkub3B0aW9uYWwoKVxufSkucmVmaW5lKHY9PiB2LnJvd3MucmVkdWNlKChzLHIpPT5zKyhyLmFtb3VudD8/MCksMCkgPD0gdi5vbkhhbmQsIFwiTW9udGFudCBkaXN0cmlidcOpID4gbW9udGFudCBlbiBtYWluXCJcbikucmVmaW5lKHY9PiAhdi5hbGxvd092ZXJyaWRlIHx8ICh2Lm92ZXJyaWRlUmVhc29uICYmIHYub3ZlcnJpZGVSZWFzb24udHJpbSgpLmxlbmd0aD49NSksIFwib3ZlcnJpZGVSZWFzb24gKOKJpSA1IGNhcmFjdMOocmVzKSByZXF1aXMgc2kgYWxsb3dPdmVycmlkZSA9IHRydWVcIik7XG5leHBvcnQgdHlwZSBEaXN0cmlidXRlSW5wdXQgPSB6LmluZmVyPHR5cGVvZiBEaXN0cmlidXRlU2NoZW1hPjtcbmV4cG9ydCBjb25zdCBSZWNvbmNpbGVTY2hlbWEgPSB6Lm9iamVjdCh7IGRlY2xhcmVkT25IYW5kOiB6Lm51bWJlcigpLmludCgpLm5vbm5lZ2F0aXZlKCkgfSk7XG5leHBvcnQgdHlwZSBSZWNvbmNpbGVJbnB1dCA9IHouaW5mZXI8dHlwZW9mIFJlY29uY2lsZVNjaGVtYT47XG5leHBvcnQgY29uc3QgR2V0RGlzdHJpYnV0aW9uUHJvcG9zYWxTY2hlbWEgPSBHZXREYXlTdW1tYXJ5U2NoZW1hO1xuZXhwb3J0IHR5cGUgR2V0RGlzdHJpYnV0aW9uUHJvcG9zYWxJbnB1dCA9IHouaW5mZXI8dHlwZW9mIEdldERpc3RyaWJ1dGlvblByb3Bvc2FsU2NoZW1hPjtcbiJdLCJuYW1lcyI6WyJ6IiwiR2V0RGF5U3VtbWFyeVNjaGVtYSIsIm9iamVjdCIsImRhdGUiLCJzdHJpbmciLCJyZWdleCIsIkRpc3RyaWJ1dGVTY2hlbWEiLCJvbkhhbmQiLCJudW1iZXIiLCJpbnQiLCJub25uZWdhdGl2ZSIsInJvd3MiLCJhcnJheSIsImVudmVsb3BlSWQiLCJtaW4iLCJwZXJjZW50IiwibWF4Iiwib3B0aW9uYWwiLCJhbW91bnQiLCJhbGxvd092ZXJyaWRlIiwiYm9vbGVhbiIsIm92ZXJyaWRlUmVhc29uIiwicmVmaW5lIiwidiIsInJlZHVjZSIsInMiLCJyIiwidHJpbSIsImxlbmd0aCIsIlJlY29uY2lsZVNjaGVtYSIsImRlY2xhcmVkT25IYW5kIiwiR2V0RGlzdHJpYnV0aW9uUHJvcG9zYWxTY2hlbWEiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/./src/server/validators/distribution.ts\n");

/***/ })

};
;