"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "_action-browser_src_server_actions_reference_ts";
exports.ids = ["_action-browser_src_server_actions_reference_ts"];
exports.modules = {

/***/ "(action-browser)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getCurrentRole: () => (/* binding */ getCurrentRole),\n/* harmony export */   requireRole: () => (/* binding */ requireRole)\n/* harmony export */ });\n/* harmony import */ var _clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @clerk/nextjs/server */ \"(action-browser)/./node_modules/.pnpm/@clerk+nextjs@5.3.1_next@15_20ea36d09dc70bbbcc56b8a0d9ae486b/node_modules/@clerk/nextjs/dist/esm/app-router/server/auth.js\");\n\nasync function getCurrentRole() {\n    if (process.env.E2E_ROLE === \"operator\" || process.env.E2E_ROLE === \"manager\" || process.env.E2E_ROLE === \"auditor\") return process.env.E2E_ROLE;\n    const { userId, sessionClaims } = (0,_clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_0__.auth)();\n    if (!userId) throw new Error(\"Unauthenticated\");\n    return sessionClaims?.role ?? \"operator\";\n}\nasync function requireRole(allowed) {\n    const role = await getCurrentRole();\n    if (!allowed.includes(role)) throw new Error(\"Forbidden\");\n    return role;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL3NyYy9saWIvYXV0aC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBNEM7QUFFckMsZUFBZUM7SUFDcEIsSUFBSUMsUUFBUUMsR0FBRyxDQUFDQyxRQUFRLEtBQUssY0FBY0YsUUFBUUMsR0FBRyxDQUFDQyxRQUFRLEtBQUssYUFBYUYsUUFBUUMsR0FBRyxDQUFDQyxRQUFRLEtBQUssV0FBVyxPQUFPRixRQUFRQyxHQUFHLENBQUNDLFFBQVE7SUFDaEosTUFBTSxFQUFFQyxNQUFNLEVBQUVDLGFBQWEsRUFBRSxHQUFHTiwwREFBSUE7SUFBSSxJQUFJLENBQUNLLFFBQVEsTUFBTSxJQUFJRSxNQUFNO0lBQ3ZFLE9BQU8sZUFBZ0JDLFFBQTZCO0FBQ3REO0FBQ08sZUFBZUMsWUFBWUMsT0FBZTtJQUFJLE1BQU1GLE9BQU8sTUFBTVA7SUFBa0IsSUFBSSxDQUFDUyxRQUFRQyxRQUFRLENBQUNILE9BQU8sTUFBTSxJQUFJRCxNQUFNO0lBQWMsT0FBT0M7QUFBTSIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxCQzI0MVxcTXVzaWNcXGZpbmFuY2UtYXBwLXYxLW1haW5cXGZpbmFuY2UtYXBwLXYxLW1haW5cXHNyY1xcbGliXFxhdXRoLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGF1dGggfSBmcm9tIFwiQGNsZXJrL25leHRqcy9zZXJ2ZXJcIjtcbmV4cG9ydCB0eXBlIFJvbGUgPSBcIm9wZXJhdG9yXCIgfCBcIm1hbmFnZXJcIiB8IFwiYXVkaXRvclwiO1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1cnJlbnRSb2xlKCk6IFByb21pc2U8Um9sZT4ge1xuICBpZiAocHJvY2Vzcy5lbnYuRTJFX1JPTEUgPT09IFwib3BlcmF0b3JcIiB8fCBwcm9jZXNzLmVudi5FMkVfUk9MRSA9PT0gXCJtYW5hZ2VyXCIgfHwgcHJvY2Vzcy5lbnYuRTJFX1JPTEUgPT09IFwiYXVkaXRvclwiKSByZXR1cm4gcHJvY2Vzcy5lbnYuRTJFX1JPTEUgYXMgUm9sZTtcbiAgY29uc3QgeyB1c2VySWQsIHNlc3Npb25DbGFpbXMgfSA9IGF1dGgoKTsgaWYgKCF1c2VySWQpIHRocm93IG5ldyBFcnJvcihcIlVuYXV0aGVudGljYXRlZFwiKTtcbiAgcmV0dXJuIChzZXNzaW9uQ2xhaW1zPy5yb2xlIGFzIFJvbGUgfCB1bmRlZmluZWQpID8/IFwib3BlcmF0b3JcIjtcbn1cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXF1aXJlUm9sZShhbGxvd2VkOiBSb2xlW10pIHsgY29uc3Qgcm9sZSA9IGF3YWl0IGdldEN1cnJlbnRSb2xlKCk7IGlmICghYWxsb3dlZC5pbmNsdWRlcyhyb2xlKSkgdGhyb3cgbmV3IEVycm9yKFwiRm9yYmlkZGVuXCIpOyByZXR1cm4gcm9sZTsgfVxuIl0sIm5hbWVzIjpbImF1dGgiLCJnZXRDdXJyZW50Um9sZSIsInByb2Nlc3MiLCJlbnYiLCJFMkVfUk9MRSIsInVzZXJJZCIsInNlc3Npb25DbGFpbXMiLCJFcnJvciIsInJvbGUiLCJyZXF1aXJlUm9sZSIsImFsbG93ZWQiLCJpbmNsdWRlcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(action-browser)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(action-browser)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst prisma = global.__prisma ??= new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\nif (true) global.__prisma = prisma;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL3NyYy9saWIvcHJpc21hLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUE4QztBQVN2QyxNQUFNQyxTQUFVQyxPQUFPQyxRQUFRLEtBQUssSUFBSUgsd0RBQVlBLEdBQUk7QUFDL0QsSUFBSUksSUFBcUMsRUFBRUYsT0FBT0MsUUFBUSxHQUFHRiIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxCQzI0MVxcTXVzaWNcXGZpbmFuY2UtYXBwLXYxLW1haW5cXGZpbmFuY2UtYXBwLXYxLW1haW5cXHNyY1xcbGliXFxwcmlzbWEudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuXG4vLyBFbnN1cmUgYSBzaW5nbGUgUHJpc21hQ2xpZW50IGluc3RhbmNlIGluIGRldmVsb3BtZW50IHRvIGF2b2lkIGV4aGF1c3Rpbmdcbi8vIGRhdGFiYXNlIGNvbm5lY3Rpb25zIGR1cmluZyBITVIgKHNlZSBQcmlzbWEgZG9jcykuXG5kZWNsYXJlIGdsb2JhbCB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby12YXJcbiAgdmFyIF9fcHJpc21hOiBQcmlzbWFDbGllbnQgfCB1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCBjb25zdCBwcmlzbWEgPSAoZ2xvYmFsLl9fcHJpc21hID8/PSBuZXcgUHJpc21hQ2xpZW50KCkpO1xuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIGdsb2JhbC5fX3ByaXNtYSA9IHByaXNtYTtcbiJdLCJuYW1lcyI6WyJQcmlzbWFDbGllbnQiLCJwcmlzbWEiLCJnbG9iYWwiLCJfX3ByaXNtYSIsInByb2Nlc3MiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/./src/lib/prisma.ts\n");

/***/ }),

/***/ "(action-browser)/./src/server/actions/reference.ts":
/*!*****************************************!*\
  !*** ./src/server/actions/reference.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   adoptSuggestedRule: () => (/* binding */ adoptSuggestedRule),\n/* harmony export */   computeReference: () => (/* binding */ computeReference)\n/* harmony export */ });\n/* harmony import */ var private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! private-next-rsc-server-reference */ \"(action-browser)/./node_modules/.pnpm/next@15.0.3_@playwright+tes_c0fbebec67a33fb30e42c14d3a81a9d2/node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js\");\n/* harmony import */ var private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! private-next-rsc-action-encryption */ \"(action-browser)/./node_modules/.pnpm/next@15.0.3_@playwright+tes_c0fbebec67a33fb30e42c14d3a81a9d2/node_modules/next/dist/server/app-render/encryption.js\");\n/* harmony import */ var private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth */ \"(action-browser)/./src/lib/auth.ts\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/prisma */ \"(action-browser)/./src/lib/prisma.ts\");\n/* harmony import */ var _server_validators_reference__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/server/validators/reference */ \"(action-browser)/./src/server/validators/reference.ts\");\n/* harmony import */ var _server_queries_reference__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/server/queries/reference */ \"(action-browser)/./src/server/queries/reference.ts\");\n/* harmony import */ var private_next_rsc_action_validate__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! private-next-rsc-action-validate */ \"(action-browser)/./node_modules/.pnpm/next@15.0.3_@playwright+tes_c0fbebec67a33fb30e42c14d3a81a9d2/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js\");\n/* __next_internal_action_entry_do_not_use__ {\"407425d02162699533b763e931c50c8e19e31a641c\":\"computeReference\",\"40f59499f3e4d28be8fadda590084bcecc7428ace8\":\"adoptSuggestedRule\"} */ \n\n\n\n\n\nasync function computeReference(input) {\n    await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_2__.requireRole)([\n        \"manager\",\n        \"auditor\",\n        \"operator\"\n    ]);\n    const p = _server_validators_reference__WEBPACK_IMPORTED_MODULE_4__.ReferencePeriodSchema.safeParse(input);\n    if (!p.success) throw new Error(p.error.errors.map((e)=>e.message).join(\"; \"));\n    return (0,_server_queries_reference__WEBPACK_IMPORTED_MODULE_5__.getSuggestedDistribution)(p.data);\n}\nasync function adoptSuggestedRule(input) {\n    await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_2__.requireRole)([\n        \"manager\"\n    ]); // adoption de règle réservée au manager\n    const p = _server_validators_reference__WEBPACK_IMPORTED_MODULE_4__.AdoptRuleSchema.safeParse(input);\n    if (!p.success) throw new Error(p.error.errors.map((e)=>e.message).join(\"; \"));\n    // Vérifier somme = 100\n    const sum = p.data.items.reduce((s, i)=>s + i.percent, 0);\n    if (sum !== 100) throw new Error(\"La somme des pourcentages doit être égale à 100%.\");\n    // Clôturer la règle active actuelle (si existe)\n    const now = new Date();\n    await _lib_prisma__WEBPACK_IMPORTED_MODULE_3__.prisma.$transaction(async (tx)=>{\n        const current = await tx.distributionRule.findFirst({\n            where: {\n                endsAt: null\n            },\n            orderBy: {\n                startsAt: \"desc\"\n            },\n            select: {\n                id: true\n            }\n        });\n        if (current) {\n            await tx.distributionRule.update({\n                where: {\n                    id: current.id\n                },\n                data: {\n                    endsAt: now\n                }\n            });\n        }\n        // Créer nouvelle règle\n        const rule = await tx.distributionRule.create({\n            data: {\n                startsAt: now,\n                items: {\n                    create: p.data.items.map((i)=>({\n                            envelopeId: i.envelopeId,\n                            percent: i.percent\n                        }))\n                }\n            },\n            select: {\n                id: true\n            }\n        });\n        return rule.id;\n    });\n    return {\n        ok: true\n    };\n}\n\n(0,private_next_rsc_action_validate__WEBPACK_IMPORTED_MODULE_6__.ensureServerEntryExports)([\n    computeReference,\n    adoptSuggestedRule\n]);\n(0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(computeReference, \"407425d02162699533b763e931c50c8e19e31a641c\", null);\n(0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(adoptSuggestedRule, \"40f59499f3e4d28be8fadda590084bcecc7428ace8\", null);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL3NyYy9zZXJ2ZXIvYWN0aW9ucy9yZWZlcmVuY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQ3lDO0FBQ0g7QUFDaUQ7QUFDakI7QUFFL0QsZUFBZUssaUJBQWlCQyxLQUFzRDtJQUMzRixNQUFNTixzREFBV0EsQ0FBQztRQUFDO1FBQVU7UUFBVTtLQUFXO0lBQ2xELE1BQU1PLElBQUlMLCtFQUFxQkEsQ0FBQ00sU0FBUyxDQUFDRjtJQUMxQyxJQUFHLENBQUNDLEVBQUVFLE9BQU8sRUFBRSxNQUFNLElBQUlDLE1BQU1ILEVBQUVJLEtBQUssQ0FBQ0MsTUFBTSxDQUFDQyxHQUFHLENBQUNDLENBQUFBLElBQUdBLEVBQUVDLE9BQU8sRUFBRUMsSUFBSSxDQUFDO0lBQ3JFLE9BQU9aLG1GQUF3QkEsQ0FBQ0csRUFBRVUsSUFBSTtBQUN4QztBQUVPLGVBQWVDLG1CQUFtQlosS0FBa0Y7SUFDekgsTUFBTU4sc0RBQVdBLENBQUM7UUFBQztLQUFVLEdBQUcsd0NBQXdDO0lBQ3hFLE1BQU1PLElBQUlKLHlFQUFlQSxDQUFDSyxTQUFTLENBQUNGO0lBQ3BDLElBQUcsQ0FBQ0MsRUFBRUUsT0FBTyxFQUFFLE1BQU0sSUFBSUMsTUFBTUgsRUFBRUksS0FBSyxDQUFDQyxNQUFNLENBQUNDLEdBQUcsQ0FBQ0MsQ0FBQUEsSUFBR0EsRUFBRUMsT0FBTyxFQUFFQyxJQUFJLENBQUM7SUFFckUsdUJBQXVCO0lBQ3ZCLE1BQU1HLE1BQU1aLEVBQUVVLElBQUksQ0FBQ0csS0FBSyxDQUFDQyxNQUFNLENBQUMsQ0FBQ0MsR0FBRUMsSUFBS0QsSUFBSUMsRUFBRUMsT0FBTyxFQUFFO0lBQ3ZELElBQUdMLFFBQVEsS0FBSyxNQUFNLElBQUlULE1BQU07SUFFaEMsZ0RBQWdEO0lBQ2hELE1BQU1lLE1BQU0sSUFBSUM7SUFDaEIsTUFBTXpCLCtDQUFNQSxDQUFDMEIsWUFBWSxDQUFDLE9BQU1DO1FBQzlCLE1BQU1DLFVBQVUsTUFBTUQsR0FBR0UsZ0JBQWdCLENBQUNDLFNBQVMsQ0FBQztZQUNsREMsT0FBTztnQkFBRUMsUUFBUTtZQUFLO1lBQ3RCQyxTQUFTO2dCQUFFQyxVQUFVO1lBQU87WUFDNUJDLFFBQVE7Z0JBQUVDLElBQUc7WUFBSztRQUNwQjtRQUNBLElBQUdSLFNBQVE7WUFDVCxNQUFNRCxHQUFHRSxnQkFBZ0IsQ0FBQ1EsTUFBTSxDQUFDO2dCQUMvQk4sT0FBTztvQkFBRUssSUFBSVIsUUFBUVEsRUFBRTtnQkFBQztnQkFDeEJwQixNQUFNO29CQUFFZ0IsUUFBUVI7Z0JBQUk7WUFDdEI7UUFDRjtRQUNBLHVCQUF1QjtRQUN2QixNQUFNYyxPQUFPLE1BQU1YLEdBQUdFLGdCQUFnQixDQUFDVSxNQUFNLENBQUM7WUFDNUN2QixNQUFNO2dCQUNKa0IsVUFBVVY7Z0JBQ1ZMLE9BQU87b0JBQ0xvQixRQUFRakMsRUFBRVUsSUFBSSxDQUFDRyxLQUFLLENBQUNQLEdBQUcsQ0FBQ1UsQ0FBQUEsSUFBTTs0QkFDN0JrQixZQUFZbEIsRUFBRWtCLFVBQVU7NEJBQ3hCakIsU0FBU0QsRUFBRUMsT0FBTzt3QkFDcEI7Z0JBQ0Y7WUFDRjtZQUNBWSxRQUFRO2dCQUFFQyxJQUFJO1lBQUs7UUFDckI7UUFDQSxPQUFPRSxLQUFLRixFQUFFO0lBQ2hCO0lBRUEsT0FBTztRQUFFSyxJQUFHO0lBQUs7QUFDbkI7OztJQS9Dc0JyQztJQU9BYTs7QUFQQWIsMEZBQUFBLENBQUFBO0FBT0FhLDBGQUFBQSxDQUFBQSIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxCQzI0MVxcTXVzaWNcXGZpbmFuY2UtYXBwLXYxLW1haW5cXGZpbmFuY2UtYXBwLXYxLW1haW5cXHNyY1xcc2VydmVyXFxhY3Rpb25zXFxyZWZlcmVuY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc2VydmVyXCI7XG5pbXBvcnQgeyByZXF1aXJlUm9sZSB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tIFwiQC9saWIvcHJpc21hXCI7XG5pbXBvcnQgeyBSZWZlcmVuY2VQZXJpb2RTY2hlbWEsIEFkb3B0UnVsZVNjaGVtYSB9IGZyb20gXCJAL3NlcnZlci92YWxpZGF0b3JzL3JlZmVyZW5jZVwiO1xuaW1wb3J0IHsgZ2V0U3VnZ2VzdGVkRGlzdHJpYnV0aW9uIH0gZnJvbSBcIkAvc2VydmVyL3F1ZXJpZXMvcmVmZXJlbmNlXCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjb21wdXRlUmVmZXJlbmNlKGlucHV0OntzdGFydDpzdHJpbmc7IGVuZDpzdHJpbmc7IGJhc2lzPzogXCJPVVRcInxcIkRJU1RcIn0pe1xuICBhd2FpdCByZXF1aXJlUm9sZShbXCJtYW5hZ2VyXCIsXCJhdWRpdG9yXCIsXCJvcGVyYXRvclwiXSk7XG4gIGNvbnN0IHAgPSBSZWZlcmVuY2VQZXJpb2RTY2hlbWEuc2FmZVBhcnNlKGlucHV0KTtcbiAgaWYoIXAuc3VjY2VzcykgdGhyb3cgbmV3IEVycm9yKHAuZXJyb3IuZXJyb3JzLm1hcChlPT5lLm1lc3NhZ2UpLmpvaW4oXCI7IFwiKSk7XG4gIHJldHVybiBnZXRTdWdnZXN0ZWREaXN0cmlidXRpb24ocC5kYXRhKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkb3B0U3VnZ2VzdGVkUnVsZShpbnB1dDp7IGl0ZW1zOntlbnZlbG9wZUlkOnN0cmluZzsgbmFtZT86c3RyaW5nOyBhbW91bnQ6bnVtYmVyOyBwZXJjZW50Om51bWJlcn1bXSB9KXtcbiAgYXdhaXQgcmVxdWlyZVJvbGUoW1wibWFuYWdlclwiXSk7IC8vIGFkb3B0aW9uIGRlIHLDqGdsZSByw6lzZXJ2w6llIGF1IG1hbmFnZXJcbiAgY29uc3QgcCA9IEFkb3B0UnVsZVNjaGVtYS5zYWZlUGFyc2UoaW5wdXQpO1xuICBpZighcC5zdWNjZXNzKSB0aHJvdyBuZXcgRXJyb3IocC5lcnJvci5lcnJvcnMubWFwKGU9PmUubWVzc2FnZSkuam9pbihcIjsgXCIpKTtcblxuICAvLyBWw6lyaWZpZXIgc29tbWUgPSAxMDBcbiAgY29uc3Qgc3VtID0gcC5kYXRhLml0ZW1zLnJlZHVjZSgocyxpKT0+IHMgKyBpLnBlcmNlbnQsIDApO1xuICBpZihzdW0gIT09IDEwMCkgdGhyb3cgbmV3IEVycm9yKFwiTGEgc29tbWUgZGVzIHBvdXJjZW50YWdlcyBkb2l0IMOqdHJlIMOpZ2FsZSDDoCAxMDAlLlwiKTtcblxuICAvLyBDbMO0dHVyZXIgbGEgcsOoZ2xlIGFjdGl2ZSBhY3R1ZWxsZSAoc2kgZXhpc3RlKVxuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICBhd2FpdCBwcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jKHR4OmFueSk9PntcbiAgICBjb25zdCBjdXJyZW50ID0gYXdhaXQgdHguZGlzdHJpYnV0aW9uUnVsZS5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IHsgZW5kc0F0OiBudWxsIH0sXG4gICAgICBvcmRlckJ5OiB7IHN0YXJ0c0F0OiBcImRlc2NcIiB9LFxuICAgICAgc2VsZWN0OiB7IGlkOnRydWUgfSxcbiAgICB9KTtcbiAgICBpZihjdXJyZW50KXtcbiAgICAgIGF3YWl0IHR4LmRpc3RyaWJ1dGlvblJ1bGUudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGN1cnJlbnQuaWQgfSxcbiAgICAgICAgZGF0YTogeyBlbmRzQXQ6IG5vdyB9LFxuICAgICAgfSk7XG4gICAgfVxuICAgIC8vIENyw6llciBub3V2ZWxsZSByw6hnbGVcbiAgICBjb25zdCBydWxlID0gYXdhaXQgdHguZGlzdHJpYnV0aW9uUnVsZS5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICBzdGFydHNBdDogbm93LFxuICAgICAgICBpdGVtczoge1xuICAgICAgICAgIGNyZWF0ZTogcC5kYXRhLml0ZW1zLm1hcChpID0+ICh7XG4gICAgICAgICAgICBlbnZlbG9wZUlkOiBpLmVudmVsb3BlSWQsXG4gICAgICAgICAgICBwZXJjZW50OiBpLnBlcmNlbnQsXG4gICAgICAgICAgfSkpLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSB9LFxuICAgIH0pO1xuICAgIHJldHVybiBydWxlLmlkO1xuICB9KTtcblxuICByZXR1cm4geyBvazp0cnVlIH07XG59XG4iXSwibmFtZXMiOlsicmVxdWlyZVJvbGUiLCJwcmlzbWEiLCJSZWZlcmVuY2VQZXJpb2RTY2hlbWEiLCJBZG9wdFJ1bGVTY2hlbWEiLCJnZXRTdWdnZXN0ZWREaXN0cmlidXRpb24iLCJjb21wdXRlUmVmZXJlbmNlIiwiaW5wdXQiLCJwIiwic2FmZVBhcnNlIiwic3VjY2VzcyIsIkVycm9yIiwiZXJyb3IiLCJlcnJvcnMiLCJtYXAiLCJlIiwibWVzc2FnZSIsImpvaW4iLCJkYXRhIiwiYWRvcHRTdWdnZXN0ZWRSdWxlIiwic3VtIiwiaXRlbXMiLCJyZWR1Y2UiLCJzIiwiaSIsInBlcmNlbnQiLCJub3ciLCJEYXRlIiwiJHRyYW5zYWN0aW9uIiwidHgiLCJjdXJyZW50IiwiZGlzdHJpYnV0aW9uUnVsZSIsImZpbmRGaXJzdCIsIndoZXJlIiwiZW5kc0F0Iiwib3JkZXJCeSIsInN0YXJ0c0F0Iiwic2VsZWN0IiwiaWQiLCJ1cGRhdGUiLCJydWxlIiwiY3JlYXRlIiwiZW52ZWxvcGVJZCIsIm9rIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(action-browser)/./src/server/actions/reference.ts\n");

/***/ }),

/***/ "(action-browser)/./src/server/queries/reference.ts":
/*!*****************************************!*\
  !*** ./src/server/queries/reference.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getSuggestedDistribution: () => (/* binding */ getSuggestedDistribution)\n/* harmony export */ });\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/prisma */ \"(action-browser)/./src/lib/prisma.ts\");\n/* harmony import */ var _server_validators_reference__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/server/validators/reference */ \"(action-browser)/./src/server/validators/reference.ts\");\n\n\nasync function getSuggestedDistribution(input) {\n    const p = _server_validators_reference__WEBPACK_IMPORTED_MODULE_1__.ReferencePeriodSchema.parse(input);\n    const range = {\n        gte: new Date(p.start + \"T00:00:00.000Z\"),\n        lte: new Date(p.end + \"T23:59:59.999Z\")\n    };\n    // On part par défaut des DÉPENSES réelles (OUT) pour calibrer la règle.\n    // Optionnel : utiliser l’historique des DISTRIBUTIONS (DIST).\n    const kind = p.basis ?? \"OUT\";\n    // Agrégat par enveloppe via allocations des transactions du type choisi.\n    const grouped = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.transactionAllocation.groupBy({\n        by: [\n            \"envelopeId\"\n        ],\n        where: {\n            transaction: {\n                kind,\n                at: range\n            }\n        },\n        _sum: {\n            amount: true\n        }\n    });\n    const ids = grouped.map((g)=>g.envelopeId);\n    const envs = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.envelope.findMany({\n        where: {\n            id: {\n                in: ids\n            }\n        },\n        select: {\n            id: true,\n            name: true\n        }\n    });\n    const nameMap = new Map(envs.map((e)=>[\n            e.id,\n            e.name\n        ]));\n    const rows = grouped.map((g)=>({\n            envelopeId: g.envelopeId,\n            name: nameMap.get(g.envelopeId) ?? g.envelopeId,\n            amount: Number(g._sum.amount ?? 0)\n        })).filter((r)=>r.amount > 0);\n    const total = rows.reduce((s, r)=>s + r.amount, 0);\n    if (total <= 0) {\n        return {\n            basis: kind,\n            total: 0,\n            items: []\n        };\n    }\n    // Pourcentages arrondis qui somment à 100 (méthode \"largest remainder\")\n    const raw = rows.map((r)=>({\n            ...r,\n            exact: r.amount * 100 / total\n        }));\n    const base = raw.map((r)=>({\n            ...r,\n            floor: Math.floor(r.exact),\n            frac: r.exact - Math.floor(r.exact)\n        }));\n    let sum = base.reduce((s, r)=>s + r.floor, 0);\n    const need = 100 - sum;\n    const sorted = [\n        ...base\n    ].sort((a, b)=>b.frac - a.frac);\n    for(let i = 0; i < need; i++){\n        sorted[i].floor += 1;\n    }\n    const result = base.map((r)=>{\n        const found = sorted.find((s)=>s.envelopeId === r.envelopeId) ?? r;\n        return {\n            envelopeId: r.envelopeId,\n            name: r.name,\n            amount: r.amount,\n            percent: found.floor\n        };\n    });\n    return {\n        basis: kind,\n        total,\n        items: result\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL3NyYy9zZXJ2ZXIvcXVlcmllcy9yZWZlcmVuY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXNDO0FBQ2dDO0FBSS9ELGVBQWVFLHlCQUF5QkMsS0FBOEM7SUFDM0YsTUFBTUMsSUFBSUgsK0VBQXFCQSxDQUFDSSxLQUFLLENBQUNGO0lBQ3RDLE1BQU1HLFFBQVE7UUFDWkMsS0FBSyxJQUFJQyxLQUFLSixFQUFFSyxLQUFLLEdBQUc7UUFDeEJDLEtBQUssSUFBSUYsS0FBS0osRUFBRU8sR0FBRyxHQUFLO0lBQzFCO0lBRUEsd0VBQXdFO0lBQ3hFLDhEQUE4RDtJQUM5RCxNQUFNQyxPQUFPUixFQUFFUyxLQUFLLElBQUk7SUFFeEIseUVBQXlFO0lBQ3pFLE1BQU1DLFVBQVUsTUFBTWQsK0NBQU1BLENBQUNlLHFCQUFxQixDQUFDQyxPQUFPLENBQUM7UUFDekRDLElBQUk7WUFBQztTQUFhO1FBQ2xCQyxPQUFPO1lBQUVDLGFBQWE7Z0JBQUVQO2dCQUFNUSxJQUFJZDtZQUFNO1FBQUU7UUFDMUNlLE1BQU07WUFBRUMsUUFBUTtRQUFLO0lBQ3ZCO0lBSUEsTUFBTUMsTUFBTVQsUUFBUVUsR0FBRyxDQUFDLENBQUNDLElBQWlCQSxFQUFFQyxVQUFVO0lBQ3RELE1BQU1DLE9BQU8sTUFBTTNCLCtDQUFNQSxDQUFDNEIsUUFBUSxDQUFDQyxRQUFRLENBQUM7UUFDMUNYLE9BQU87WUFBRVksSUFBSTtnQkFBRUMsSUFBSVI7WUFBSTtRQUFFO1FBQ3pCUyxRQUFRO1lBQUVGLElBQUc7WUFBTUcsTUFBSztRQUFLO0lBQy9CO0lBQ0EsTUFBTUMsVUFBVSxJQUFJQyxJQUFJUixLQUFLSCxHQUFHLENBQUMsQ0FBQ1ksSUFBNEI7WUFBQ0EsRUFBRU4sRUFBRTtZQUFFTSxFQUFFSCxJQUFJO1NBQUM7SUFHNUUsTUFBTUksT0FBY3ZCLFFBQVFVLEdBQUcsQ0FBQyxDQUFDQyxJQUFrQjtZQUNqREMsWUFBWUQsRUFBRUMsVUFBVTtZQUN4Qk8sTUFBTUMsUUFBUUksR0FBRyxDQUFDYixFQUFFQyxVQUFVLEtBQUtELEVBQUVDLFVBQVU7WUFDL0NKLFFBQVFpQixPQUFPZCxFQUFFSixJQUFJLENBQUNDLE1BQU0sSUFBSTtRQUNsQyxJQUFJa0IsTUFBTSxDQUFDLENBQUNDLElBQVVBLEVBQUVuQixNQUFNLEdBQUc7SUFFakMsTUFBTW9CLFFBQVFMLEtBQUtNLE1BQU0sQ0FBQyxDQUFDQyxHQUFFSCxJQUFLRyxJQUFJSCxFQUFFbkIsTUFBTSxFQUFFO0lBQ2hELElBQUdvQixTQUFTLEdBQUU7UUFDWixPQUFPO1lBQUU3QixPQUFPRDtZQUFNOEIsT0FBTztZQUFHRyxPQUFPLEVBQUU7UUFBd0U7SUFDbkg7SUFFQSx3RUFBd0U7SUFDeEUsTUFBTUMsTUFBTVQsS0FBS2IsR0FBRyxDQUFDaUIsQ0FBQUEsSUFBTTtZQUFFLEdBQUdBLENBQUM7WUFBRU0sT0FBTyxFQUFHekIsTUFBTSxHQUFDLE1BQUtvQjtRQUFNO0lBQy9ELE1BQU1NLE9BQU9GLElBQUl0QixHQUFHLENBQUNpQixDQUFBQSxJQUFNO1lBQUUsR0FBR0EsQ0FBQztZQUFFUSxPQUFPQyxLQUFLRCxLQUFLLENBQUNSLEVBQUVNLEtBQUs7WUFBR0ksTUFBTVYsRUFBRU0sS0FBSyxHQUFHRyxLQUFLRCxLQUFLLENBQUNSLEVBQUVNLEtBQUs7UUFBRTtJQUNuRyxJQUFJSyxNQUFNSixLQUFLTCxNQUFNLENBQUMsQ0FBQ0MsR0FBRUgsSUFBS0csSUFBSUgsRUFBRVEsS0FBSyxFQUFFO0lBQzNDLE1BQU1JLE9BQU8sTUFBTUQ7SUFDbkIsTUFBTUUsU0FBUztXQUFJTjtLQUFLLENBQUNPLElBQUksQ0FBQyxDQUFDQyxHQUFFQyxJQUFLQSxFQUFFTixJQUFJLEdBQUdLLEVBQUVMLElBQUk7SUFDckQsSUFBSSxJQUFJTyxJQUFFLEdBQUVBLElBQUVMLE1BQUtLLElBQUk7UUFBRUosTUFBTSxDQUFDSSxFQUFFLENBQUNULEtBQUssSUFBSTtJQUFHO0lBQy9DLE1BQU1VLFNBQVNYLEtBQUt4QixHQUFHLENBQUNpQixDQUFBQTtRQUN0QixNQUFNbUIsUUFBUU4sT0FBT08sSUFBSSxDQUFDakIsQ0FBQUEsSUFBR0EsRUFBRWxCLFVBQVUsS0FBR2UsRUFBRWYsVUFBVSxLQUFLZTtRQUM3RCxPQUFPO1lBQUVmLFlBQVdlLEVBQUVmLFVBQVU7WUFBRU8sTUFBS1EsRUFBRVIsSUFBSTtZQUFFWCxRQUFPbUIsRUFBRW5CLE1BQU07WUFBRXdDLFNBQVNGLE1BQU1YLEtBQUs7UUFBQztJQUN2RjtJQUVBLE9BQU87UUFBRXBDLE9BQU9EO1FBQU04QjtRQUFPRyxPQUFPYztJQUFPO0FBQzdDIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXEJDMjQxXFxNdXNpY1xcZmluYW5jZS1hcHAtdjEtbWFpblxcZmluYW5jZS1hcHAtdjEtbWFpblxcc3JjXFxzZXJ2ZXJcXHF1ZXJpZXNcXHJlZmVyZW5jZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwcmlzbWEgfSBmcm9tIFwiQC9saWIvcHJpc21hXCI7XG5pbXBvcnQgeyBSZWZlcmVuY2VQZXJpb2RTY2hlbWEgfSBmcm9tIFwiQC9zZXJ2ZXIvdmFsaWRhdG9ycy9yZWZlcmVuY2VcIjtcblxudHlwZSBCYXNpcyA9IFwiT1VUXCIgfCBcIkRJU1RcIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFN1Z2dlc3RlZERpc3RyaWJ1dGlvbihpbnB1dDp7c3RhcnQ6c3RyaW5nOyBlbmQ6c3RyaW5nOyBiYXNpcz86QmFzaXN9KXtcbiAgY29uc3QgcCA9IFJlZmVyZW5jZVBlcmlvZFNjaGVtYS5wYXJzZShpbnB1dCk7XG4gIGNvbnN0IHJhbmdlID0ge1xuICAgIGd0ZTogbmV3IERhdGUocC5zdGFydCArIFwiVDAwOjAwOjAwLjAwMFpcIiksXG4gICAgbHRlOiBuZXcgRGF0ZShwLmVuZCAgICsgXCJUMjM6NTk6NTkuOTk5WlwiKSxcbiAgfTtcblxuICAvLyBPbiBwYXJ0IHBhciBkw6lmYXV0IGRlcyBEw4lQRU5TRVMgcsOpZWxsZXMgKE9VVCkgcG91ciBjYWxpYnJlciBsYSByw6hnbGUuXG4gIC8vIE9wdGlvbm5lbCA6IHV0aWxpc2VyIGzigJloaXN0b3JpcXVlIGRlcyBESVNUUklCVVRJT05TIChESVNUKS5cbiAgY29uc3Qga2luZCA9IHAuYmFzaXMgPz8gXCJPVVRcIjtcblxuICAvLyBBZ3LDqWdhdCBwYXIgZW52ZWxvcHBlIHZpYSBhbGxvY2F0aW9ucyBkZXMgdHJhbnNhY3Rpb25zIGR1IHR5cGUgY2hvaXNpLlxuICBjb25zdCBncm91cGVkID0gYXdhaXQgcHJpc21hLnRyYW5zYWN0aW9uQWxsb2NhdGlvbi5ncm91cEJ5KHtcbiAgICBieTogW1wiZW52ZWxvcGVJZFwiXSxcbiAgICB3aGVyZTogeyB0cmFuc2FjdGlvbjogeyBraW5kLCBhdDogcmFuZ2UgfSB9LFxuICAgIF9zdW06IHsgYW1vdW50OiB0cnVlIH0sXG4gIH0pO1xuXG4gIC8vIFLDqWN1cMOpcmVyIG5vbXMvcHJvcHJpw6l0w6lzIGRlcyBlbnZlbG9wcGVzXG4gIHR5cGUgR3JvdXBlZFJvdyA9IHsgZW52ZWxvcGVJZDogc3RyaW5nOyBfc3VtOiB7IGFtb3VudDogbnVtYmVyIHwgbnVsbCB9IH07XG4gIGNvbnN0IGlkcyA9IGdyb3VwZWQubWFwKChnOkdyb3VwZWRSb3cpID0+IGcuZW52ZWxvcGVJZCk7XG4gIGNvbnN0IGVudnMgPSBhd2FpdCBwcmlzbWEuZW52ZWxvcGUuZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7IGlkOiB7IGluOiBpZHMgfSB9LFxuICAgIHNlbGVjdDogeyBpZDp0cnVlLCBuYW1lOnRydWUgfSxcbiAgfSk7XG4gIGNvbnN0IG5hbWVNYXAgPSBuZXcgTWFwKGVudnMubWFwKChlOntpZDpzdHJpbmc7bmFtZTpzdHJpbmd9KT0+W2UuaWQsIGUubmFtZV0pKTtcblxuICB0eXBlIFJvdyA9IHsgZW52ZWxvcGVJZDpzdHJpbmc7IG5hbWU6c3RyaW5nOyBhbW91bnQ6bnVtYmVyIH07XG4gIGNvbnN0IHJvd3M6IFJvd1tdID0gZ3JvdXBlZC5tYXAoKGc6R3JvdXBlZFJvdykgPT4gKHtcbiAgICBlbnZlbG9wZUlkOiBnLmVudmVsb3BlSWQsXG4gICAgbmFtZTogbmFtZU1hcC5nZXQoZy5lbnZlbG9wZUlkKSA/PyBnLmVudmVsb3BlSWQsXG4gICAgYW1vdW50OiBOdW1iZXIoZy5fc3VtLmFtb3VudCA/PyAwKSxcbiAgfSkpLmZpbHRlcigocjpSb3cpID0+IHIuYW1vdW50ID4gMCk7XG5cbiAgY29uc3QgdG90YWwgPSByb3dzLnJlZHVjZSgocyxyKT0+IHMgKyByLmFtb3VudCwgMCk7XG4gIGlmKHRvdGFsIDw9IDApe1xuICAgIHJldHVybiB7IGJhc2lzOiBraW5kLCB0b3RhbDogMCwgaXRlbXM6IFtdIGFzIHsgZW52ZWxvcGVJZDpzdHJpbmc7IG5hbWU6c3RyaW5nOyBhbW91bnQ6bnVtYmVyOyBwZXJjZW50Om51bWJlciB9W10gfTtcbiAgfVxuXG4gIC8vIFBvdXJjZW50YWdlcyBhcnJvbmRpcyBxdWkgc29tbWVudCDDoCAxMDAgKG3DqXRob2RlIFwibGFyZ2VzdCByZW1haW5kZXJcIilcbiAgY29uc3QgcmF3ID0gcm93cy5tYXAociA9PiAoeyAuLi5yLCBleGFjdDogKHIuYW1vdW50KjEwMCkvdG90YWwgfSkpO1xuICBjb25zdCBiYXNlID0gcmF3Lm1hcChyID0+ICh7IC4uLnIsIGZsb29yOiBNYXRoLmZsb29yKHIuZXhhY3QpLCBmcmFjOiByLmV4YWN0IC0gTWF0aC5mbG9vcihyLmV4YWN0KSB9KSk7XG4gIGxldCBzdW0gPSBiYXNlLnJlZHVjZSgocyxyKT0+IHMgKyByLmZsb29yLCAwKTtcbiAgY29uc3QgbmVlZCA9IDEwMCAtIHN1bTtcbiAgY29uc3Qgc29ydGVkID0gWy4uLmJhc2VdLnNvcnQoKGEsYik9PiBiLmZyYWMgLSBhLmZyYWMpO1xuICBmb3IobGV0IGk9MDtpPG5lZWQ7aSsrKXsgc29ydGVkW2ldLmZsb29yICs9IDE7IH1cbiAgY29uc3QgcmVzdWx0ID0gYmFzZS5tYXAociA9PiB7XG4gICAgY29uc3QgZm91bmQgPSBzb3J0ZWQuZmluZChzPT5zLmVudmVsb3BlSWQ9PT1yLmVudmVsb3BlSWQpID8/IHI7XG4gICAgcmV0dXJuIHsgZW52ZWxvcGVJZDpyLmVudmVsb3BlSWQsIG5hbWU6ci5uYW1lLCBhbW91bnQ6ci5hbW91bnQsIHBlcmNlbnQ6IGZvdW5kLmZsb29yIH07XG4gIH0pO1xuXG4gIHJldHVybiB7IGJhc2lzOiBraW5kLCB0b3RhbCwgaXRlbXM6IHJlc3VsdCB9O1xufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsIlJlZmVyZW5jZVBlcmlvZFNjaGVtYSIsImdldFN1Z2dlc3RlZERpc3RyaWJ1dGlvbiIsImlucHV0IiwicCIsInBhcnNlIiwicmFuZ2UiLCJndGUiLCJEYXRlIiwic3RhcnQiLCJsdGUiLCJlbmQiLCJraW5kIiwiYmFzaXMiLCJncm91cGVkIiwidHJhbnNhY3Rpb25BbGxvY2F0aW9uIiwiZ3JvdXBCeSIsImJ5Iiwid2hlcmUiLCJ0cmFuc2FjdGlvbiIsImF0IiwiX3N1bSIsImFtb3VudCIsImlkcyIsIm1hcCIsImciLCJlbnZlbG9wZUlkIiwiZW52cyIsImVudmVsb3BlIiwiZmluZE1hbnkiLCJpZCIsImluIiwic2VsZWN0IiwibmFtZSIsIm5hbWVNYXAiLCJNYXAiLCJlIiwicm93cyIsImdldCIsIk51bWJlciIsImZpbHRlciIsInIiLCJ0b3RhbCIsInJlZHVjZSIsInMiLCJpdGVtcyIsInJhdyIsImV4YWN0IiwiYmFzZSIsImZsb29yIiwiTWF0aCIsImZyYWMiLCJzdW0iLCJuZWVkIiwic29ydGVkIiwic29ydCIsImEiLCJiIiwiaSIsInJlc3VsdCIsImZvdW5kIiwiZmluZCIsInBlcmNlbnQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/./src/server/queries/reference.ts\n");

/***/ }),

/***/ "(action-browser)/./src/server/validators/reference.ts":
/*!********************************************!*\
  !*** ./src/server/validators/reference.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AdoptRuleSchema: () => (/* binding */ AdoptRuleSchema),\n/* harmony export */   ReferencePeriodSchema: () => (/* binding */ ReferencePeriodSchema),\n/* harmony export */   SuggestedItemSchema: () => (/* binding */ SuggestedItemSchema)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(action-browser)/./node_modules/.pnpm/zod@3.23.8/node_modules/zod/lib/index.mjs\");\n\nconst ReferencePeriodSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    start: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(10, \"start manquant (YYYY-MM-DD)\"),\n    end: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(10, \"end manquant (YYYY-MM-DD)\"),\n    basis: zod__WEBPACK_IMPORTED_MODULE_0__.z.enum([\n        \"OUT\",\n        \"DIST\"\n    ]).default(\"OUT\")\n});\nconst SuggestedItemSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    envelopeId: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1),\n    name: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    amount: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().nonnegative().default(0),\n    percent: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().min(0).max(100)\n});\nconst AdoptRuleSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    items: zod__WEBPACK_IMPORTED_MODULE_0__.z.array(SuggestedItemSchema).min(1)\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL3NyYy9zZXJ2ZXIvdmFsaWRhdG9ycy9yZWZlcmVuY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUF3QjtBQUVqQixNQUFNQyx3QkFBd0JELGtDQUFDQSxDQUFDRSxNQUFNLENBQUM7SUFDNUNDLE9BQU9ILGtDQUFDQSxDQUFDSSxNQUFNLEdBQUdDLEdBQUcsQ0FBQyxJQUFJO0lBQzFCQyxLQUFLTixrQ0FBQ0EsQ0FBQ0ksTUFBTSxHQUFHQyxHQUFHLENBQUMsSUFBSTtJQUN4QkUsT0FBT1Asa0NBQUNBLENBQUNRLElBQUksQ0FBQztRQUFDO1FBQU07S0FBTyxFQUFFQyxPQUFPLENBQUM7QUFDeEMsR0FBRztBQUVJLE1BQU1DLHNCQUFzQlYsa0NBQUNBLENBQUNFLE1BQU0sQ0FBQztJQUMxQ1MsWUFBWVgsa0NBQUNBLENBQUNJLE1BQU0sR0FBR0MsR0FBRyxDQUFDO0lBQzNCTyxNQUFNWixrQ0FBQ0EsQ0FBQ0ksTUFBTSxHQUFHUyxRQUFRO0lBQ3pCQyxRQUFRZCxrQ0FBQ0EsQ0FBQ2UsTUFBTSxHQUFHQyxHQUFHLEdBQUdDLFdBQVcsR0FBR1IsT0FBTyxDQUFDO0lBQy9DUyxTQUFTbEIsa0NBQUNBLENBQUNlLE1BQU0sR0FBR0MsR0FBRyxHQUFHWCxHQUFHLENBQUMsR0FBR2MsR0FBRyxDQUFDO0FBQ3ZDLEdBQUc7QUFFSSxNQUFNQyxrQkFBa0JwQixrQ0FBQ0EsQ0FBQ0UsTUFBTSxDQUFDO0lBQ3RDbUIsT0FBT3JCLGtDQUFDQSxDQUFDc0IsS0FBSyxDQUFDWixxQkFBcUJMLEdBQUcsQ0FBQztBQUMxQyxHQUFHIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXEJDMjQxXFxNdXNpY1xcZmluYW5jZS1hcHAtdjEtbWFpblxcZmluYW5jZS1hcHAtdjEtbWFpblxcc3JjXFxzZXJ2ZXJcXHZhbGlkYXRvcnNcXHJlZmVyZW5jZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB6IH0gZnJvbSBcInpvZFwiO1xuXG5leHBvcnQgY29uc3QgUmVmZXJlbmNlUGVyaW9kU2NoZW1hID0gei5vYmplY3Qoe1xuICBzdGFydDogei5zdHJpbmcoKS5taW4oMTAsIFwic3RhcnQgbWFucXVhbnQgKFlZWVktTU0tREQpXCIpLFxuICBlbmQ6IHouc3RyaW5nKCkubWluKDEwLCBcImVuZCBtYW5xdWFudCAoWVlZWS1NTS1ERClcIiksXG4gIGJhc2lzOiB6LmVudW0oW1wiT1VUXCIsXCJESVNUXCJdKS5kZWZhdWx0KFwiT1VUXCIpLFxufSk7XG5cbmV4cG9ydCBjb25zdCBTdWdnZXN0ZWRJdGVtU2NoZW1hID0gei5vYmplY3Qoe1xuICBlbnZlbG9wZUlkOiB6LnN0cmluZygpLm1pbigxKSxcbiAgbmFtZTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBhbW91bnQ6IHoubnVtYmVyKCkuaW50KCkubm9ubmVnYXRpdmUoKS5kZWZhdWx0KDApLFxuICBwZXJjZW50OiB6Lm51bWJlcigpLmludCgpLm1pbigwKS5tYXgoMTAwKSxcbn0pO1xuXG5leHBvcnQgY29uc3QgQWRvcHRSdWxlU2NoZW1hID0gei5vYmplY3Qoe1xuICBpdGVtczogei5hcnJheShTdWdnZXN0ZWRJdGVtU2NoZW1hKS5taW4oMSksXG59KTtcbiJdLCJuYW1lcyI6WyJ6IiwiUmVmZXJlbmNlUGVyaW9kU2NoZW1hIiwib2JqZWN0Iiwic3RhcnQiLCJzdHJpbmciLCJtaW4iLCJlbmQiLCJiYXNpcyIsImVudW0iLCJkZWZhdWx0IiwiU3VnZ2VzdGVkSXRlbVNjaGVtYSIsImVudmVsb3BlSWQiLCJuYW1lIiwib3B0aW9uYWwiLCJhbW91bnQiLCJudW1iZXIiLCJpbnQiLCJub25uZWdhdGl2ZSIsInBlcmNlbnQiLCJtYXgiLCJBZG9wdFJ1bGVTY2hlbWEiLCJpdGVtcyIsImFycmF5Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(action-browser)/./src/server/validators/reference.ts\n");

/***/ })

};
;