"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "_action-browser_src_server_actions_distribution_ts";
exports.ids = ["_action-browser_src_server_actions_distribution_ts"];
exports.modules = {

/***/ "(action-browser)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getCurrentRole: () => (/* binding */ getCurrentRole),\n/* harmony export */   requireRole: () => (/* binding */ requireRole)\n/* harmony export */ });\n/* harmony import */ var _clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @clerk/nextjs/server */ \"(action-browser)/./node_modules/.pnpm/@clerk+nextjs@5.3.1_next@15_20ea36d09dc70bbbcc56b8a0d9ae486b/node_modules/@clerk/nextjs/dist/esm/app-router/server/auth.js\");\n\nasync function getCurrentRole() {\n    if (process.env.E2E_ROLE === \"operator\" || process.env.E2E_ROLE === \"manager\" || process.env.E2E_ROLE === \"auditor\") return process.env.E2E_ROLE;\n    const { userId, sessionClaims } = (0,_clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_0__.auth)();\n    if (!userId) throw new Error(\"Unauthenticated\");\n    return sessionClaims?.role ?? \"operator\";\n}\nasync function requireRole(allowed) {\n    const role = await getCurrentRole();\n    if (!allowed.includes(role)) throw new Error(\"Forbidden\");\n    return role;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL3NyYy9saWIvYXV0aC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBNEM7QUFFckMsZUFBZUM7SUFDcEIsSUFBSUMsUUFBUUMsR0FBRyxDQUFDQyxRQUFRLEtBQUssY0FBY0YsUUFBUUMsR0FBRyxDQUFDQyxRQUFRLEtBQUssYUFBYUYsUUFBUUMsR0FBRyxDQUFDQyxRQUFRLEtBQUssV0FBVyxPQUFPRixRQUFRQyxHQUFHLENBQUNDLFFBQVE7SUFDaEosTUFBTSxFQUFFQyxNQUFNLEVBQUVDLGFBQWEsRUFBRSxHQUFHTiwwREFBSUE7SUFBSSxJQUFJLENBQUNLLFFBQVEsTUFBTSxJQUFJRSxNQUFNO0lBQ3ZFLE9BQU8sZUFBZ0JDLFFBQTZCO0FBQ3REO0FBQ08sZUFBZUMsWUFBWUMsT0FBZTtJQUFJLE1BQU1GLE9BQU8sTUFBTVA7SUFBa0IsSUFBSSxDQUFDUyxRQUFRQyxRQUFRLENBQUNILE9BQU8sTUFBTSxJQUFJRCxNQUFNO0lBQWMsT0FBT0M7QUFBTSIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxCQzI0MVxcTXVzaWNcXGZpbmFuY2UtYXBwLXYxLW1haW5cXGZpbmFuY2UtYXBwLXYxLW1haW5cXHNyY1xcbGliXFxhdXRoLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGF1dGggfSBmcm9tIFwiQGNsZXJrL25leHRqcy9zZXJ2ZXJcIjtcbmV4cG9ydCB0eXBlIFJvbGUgPSBcIm9wZXJhdG9yXCIgfCBcIm1hbmFnZXJcIiB8IFwiYXVkaXRvclwiO1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1cnJlbnRSb2xlKCk6IFByb21pc2U8Um9sZT4ge1xuICBpZiAocHJvY2Vzcy5lbnYuRTJFX1JPTEUgPT09IFwib3BlcmF0b3JcIiB8fCBwcm9jZXNzLmVudi5FMkVfUk9MRSA9PT0gXCJtYW5hZ2VyXCIgfHwgcHJvY2Vzcy5lbnYuRTJFX1JPTEUgPT09IFwiYXVkaXRvclwiKSByZXR1cm4gcHJvY2Vzcy5lbnYuRTJFX1JPTEUgYXMgUm9sZTtcbiAgY29uc3QgeyB1c2VySWQsIHNlc3Npb25DbGFpbXMgfSA9IGF1dGgoKTsgaWYgKCF1c2VySWQpIHRocm93IG5ldyBFcnJvcihcIlVuYXV0aGVudGljYXRlZFwiKTtcbiAgcmV0dXJuIChzZXNzaW9uQ2xhaW1zPy5yb2xlIGFzIFJvbGUgfCB1bmRlZmluZWQpID8/IFwib3BlcmF0b3JcIjtcbn1cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXF1aXJlUm9sZShhbGxvd2VkOiBSb2xlW10pIHsgY29uc3Qgcm9sZSA9IGF3YWl0IGdldEN1cnJlbnRSb2xlKCk7IGlmICghYWxsb3dlZC5pbmNsdWRlcyhyb2xlKSkgdGhyb3cgbmV3IEVycm9yKFwiRm9yYmlkZGVuXCIpOyByZXR1cm4gcm9sZTsgfVxuIl0sIm5hbWVzIjpbImF1dGgiLCJnZXRDdXJyZW50Um9sZSIsInByb2Nlc3MiLCJlbnYiLCJFMkVfUk9MRSIsInVzZXJJZCIsInNlc3Npb25DbGFpbXMiLCJFcnJvciIsInJvbGUiLCJyZXF1aXJlUm9sZSIsImFsbG93ZWQiLCJpbmNsdWRlcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(action-browser)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(action-browser)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst prisma = global.__prisma ??= new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\nif (true) global.__prisma = prisma;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL3NyYy9saWIvcHJpc21hLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUE4QztBQVN2QyxNQUFNQyxTQUFVQyxPQUFPQyxRQUFRLEtBQUssSUFBSUgsd0RBQVlBLEdBQUk7QUFDL0QsSUFBSUksSUFBcUMsRUFBRUYsT0FBT0MsUUFBUSxHQUFHRiIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxCQzI0MVxcTXVzaWNcXGZpbmFuY2UtYXBwLXYxLW1haW5cXGZpbmFuY2UtYXBwLXYxLW1haW5cXHNyY1xcbGliXFxwcmlzbWEudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuXG4vLyBFbnN1cmUgYSBzaW5nbGUgUHJpc21hQ2xpZW50IGluc3RhbmNlIGluIGRldmVsb3BtZW50IHRvIGF2b2lkIGV4aGF1c3Rpbmdcbi8vIGRhdGFiYXNlIGNvbm5lY3Rpb25zIGR1cmluZyBITVIgKHNlZSBQcmlzbWEgZG9jcykuXG5kZWNsYXJlIGdsb2JhbCB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby12YXJcbiAgdmFyIF9fcHJpc21hOiBQcmlzbWFDbGllbnQgfCB1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCBjb25zdCBwcmlzbWEgPSAoZ2xvYmFsLl9fcHJpc21hID8/PSBuZXcgUHJpc21hQ2xpZW50KCkpO1xuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIGdsb2JhbC5fX3ByaXNtYSA9IHByaXNtYTtcbiJdLCJuYW1lcyI6WyJQcmlzbWFDbGllbnQiLCJwcmlzbWEiLCJnbG9iYWwiLCJfX3ByaXNtYSIsInByb2Nlc3MiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/./src/lib/prisma.ts\n");

/***/ }),

/***/ "(action-browser)/./src/server/actions/distribution.ts":
/*!********************************************!*\
  !*** ./src/server/actions/distribution.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   distribute: () => (/* binding */ distribute),\n/* harmony export */   getDaySummary: () => (/* binding */ getDaySummary),\n/* harmony export */   reconcile: () => (/* binding */ reconcile)\n/* harmony export */ });\n/* harmony import */ var private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! private-next-rsc-server-reference */ \"(action-browser)/./node_modules/.pnpm/next@15.0.3_@playwright+tes_c0fbebec67a33fb30e42c14d3a81a9d2/node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js\");\n/* harmony import */ var private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! private-next-rsc-action-encryption */ \"(action-browser)/./node_modules/.pnpm/next@15.0.3_@playwright+tes_c0fbebec67a33fb30e42c14d3a81a9d2/node_modules/next/dist/server/app-render/encryption.js\");\n/* harmony import */ var private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/prisma */ \"(action-browser)/./src/lib/prisma.ts\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/auth */ \"(action-browser)/./src/lib/auth.ts\");\n/* harmony import */ var _server_validators_distribution__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/server/validators/distribution */ \"(action-browser)/./src/server/validators/distribution.ts\");\n/* harmony import */ var _server_queries_ledger__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/server/queries/ledger */ \"(action-browser)/./src/server/queries/ledger.ts\");\n/* harmony import */ var _server_queries_rules__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/server/queries/rules */ \"(action-browser)/./src/server/queries/rules.ts\");\n/* harmony import */ var private_next_rsc_action_validate__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! private-next-rsc-action-validate */ \"(action-browser)/./node_modules/.pnpm/next@15.0.3_@playwright+tes_c0fbebec67a33fb30e42c14d3a81a9d2/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js\");\n/* __next_internal_action_entry_do_not_use__ {\"4006511558c88897ad1f2a7dc13be32f7efe7085d4\":\"reconcile\",\"4075209a9494b6b89554f565559f3b3672c334b54b\":\"distribute\",\"40a221be3b9fb29b69f99ca1138d130af4d1b7a6e4\":\"getDaySummary\"} */ \n\n\n\n\n\n\nasync function getDaySummary({ date }) {\n    const parsed = _server_validators_distribution__WEBPACK_IMPORTED_MODULE_4__.GetDaySummarySchema.safeParse({\n        date\n    });\n    if (!parsed.success) throw new Error(parsed.error.errors.map((e)=>e.message).join(\"; \"));\n    return (0,_server_queries_ledger__WEBPACK_IMPORTED_MODULE_5__.getDayTotals)(parsed.data.date);\n}\nasync function distribute(input) {\n    await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_3__.requireRole)([\n        \"operator\",\n        \"manager\"\n    ]);\n    const parsed = _server_validators_distribution__WEBPACK_IMPORTED_MODULE_4__.DistributeSchema.safeParse(input);\n    if (!parsed.success) throw new Error(parsed.error.errors.map((e)=>e.message).join(\"; \"));\n    const total = parsed.data.rows.reduce((s, r)=>s + (r.amount || 0), 0);\n    const rule = await (0,_server_queries_rules__WEBPACK_IMPORTED_MODULE_6__.getActiveDistributionRule)();\n    const warnings = [];\n    if (rule && rule.items.length && total > 0) {\n        const map = new Map(rule.items.map((i)=>[\n                i.envelopeId,\n                i.percent\n            ]));\n        for (const r of parsed.data.rows){\n            const exp = map.get(r.envelopeId);\n            if (typeof exp === \"number\") {\n                const pct = Math.round((r.amount || 0) / total * 100);\n                if (pct != exp) warnings.push(`Écart barème: ${r.envelopeId} — attendu ${exp}% vs ${pct}%`);\n            }\n        }\n    }\n    if (warnings.length && !parsed.data.allowOverride) throw new Error(\"Écarts au barème — confirmation requise (allowOverride + overrideReason).\");\n    const tx = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.transaction.create({\n        data: {\n            kind: \"DIST\",\n            label: \"Distribution\",\n            amount: total,\n            at: new Date()\n        }\n    });\n    await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.transactionAllocation.createMany({\n        data: parsed.data.rows.map((r)=>({\n                transactionId: tx.id,\n                envelopeId: r.envelopeId,\n                amount: r.amount || 0\n            }))\n    });\n    if (warnings.length) {\n        await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.anomaly.createMany({\n            data: warnings.map((w)=>({\n                    level: \"warning\",\n                    code: \"DISTRIBUTION_RULE_MISMATCH\",\n                    details: parsed.data.overrideReason ? `${w} — Raison: ${parsed.data.overrideReason}` : w,\n                    transactionId: tx.id\n                }))\n        });\n    }\n    return {\n        transactionId: tx.id,\n        warnings\n    };\n}\nasync function reconcile(input) {\n    await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_3__.requireRole)([\n        \"operator\",\n        \"manager\"\n    ]);\n    const parsed = _server_validators_distribution__WEBPACK_IMPORTED_MODULE_4__.ReconcileSchema.safeParse(input);\n    if (!parsed.success) throw new Error(parsed.error.errors.map((e)=>e.message).join(\"; \"));\n    const todayISO = new Date().toISOString().slice(0, 10);\n    const day = await (0,_server_queries_ledger__WEBPACK_IMPORTED_MODULE_5__.getDayTotals)(todayISO);\n    const diff = parsed.data.declaredOnHand - day.onHand;\n    if (diff === 0) return {\n        ok: true,\n        diff: 0,\n        suggestions: []\n    };\n    return {\n        ok: false,\n        diff,\n        suggestions: diff > 0 ? [\n            \"Vérifiez une entrée manquante.\"\n        ] : [\n            \"Vérifiez une dépense manquante.\"\n        ]\n    };\n}\n\n(0,private_next_rsc_action_validate__WEBPACK_IMPORTED_MODULE_7__.ensureServerEntryExports)([\n    getDaySummary,\n    distribute,\n    reconcile\n]);\n(0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(getDaySummary, \"40a221be3b9fb29b69f99ca1138d130af4d1b7a6e4\", null);\n(0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(distribute, \"4075209a9494b6b89554f565559f3b3672c334b54b\", null);\n(0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(reconcile, \"4006511558c88897ad1f2a7dc13be32f7efe7085d4\", null);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL3NyYy9zZXJ2ZXIvYWN0aW9ucy9kaXN0cmlidXRpb24udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDc0M7QUFDRztBQUNpRTtBQUNuRDtBQUNZO0FBRTVELGVBQWVPLGNBQWMsRUFBRUMsSUFBSSxFQUFnQjtJQUN4RCxNQUFNQyxTQUFPUCxnRkFBbUJBLENBQUNRLFNBQVMsQ0FBQztRQUFDRjtJQUFJO0lBQUksSUFBRyxDQUFDQyxPQUFPRSxPQUFPLEVBQUUsTUFBTSxJQUFJQyxNQUFNSCxPQUFPSSxLQUFLLENBQUNDLE1BQU0sQ0FBQ0MsR0FBRyxDQUFDQyxDQUFBQSxJQUFHQSxFQUFFQyxPQUFPLEVBQUVDLElBQUksQ0FBQztJQUNuSSxPQUFPYixvRUFBWUEsQ0FBQ0ksT0FBT1UsSUFBSSxDQUFDWCxJQUFJO0FBQ3RDO0FBQ08sZUFBZVksV0FBV0MsS0FBc0k7SUFDckssTUFBTXBCLHNEQUFXQSxDQUFDO1FBQUM7UUFBVztLQUFVO0lBQ3hDLE1BQU1RLFNBQU9OLDZFQUFnQkEsQ0FBQ08sU0FBUyxDQUFDVztJQUFRLElBQUcsQ0FBQ1osT0FBT0UsT0FBTyxFQUFFLE1BQU0sSUFBSUMsTUFBTUgsT0FBT0ksS0FBSyxDQUFDQyxNQUFNLENBQUNDLEdBQUcsQ0FBQ0MsQ0FBQUEsSUFBR0EsRUFBRUMsT0FBTyxFQUFFQyxJQUFJLENBQUM7SUFDL0gsTUFBTUksUUFBTWIsT0FBT1UsSUFBSSxDQUFDSSxJQUFJLENBQUNDLE1BQU0sQ0FBQyxDQUFDQyxHQUFFQyxJQUFJRCxJQUFHQyxDQUFBQSxFQUFFQyxNQUFNLElBQUUsSUFBRztJQUMzRCxNQUFNQyxPQUFLLE1BQU10QixnRkFBeUJBO0lBQzFDLE1BQU11QixXQUFrQixFQUFFO0lBQzFCLElBQUdELFFBQVFBLEtBQUtFLEtBQUssQ0FBQ0MsTUFBTSxJQUFJVCxRQUFNLEdBQUU7UUFDdEMsTUFBTVAsTUFBSSxJQUFJaUIsSUFBSUosS0FBS0UsS0FBSyxDQUFDZixH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aWNcXGZpbmFuY2UtYXBwLXYxLW1haW5cXGZpbmFuY2UtYXBwLXYxLW1haW5cXHNyY1xcc2VydmVyXFxhY3Rpb25zXFxkaXN0cmlidXRpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc2VydmVyXCI7XG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tIFwiQC9saWIvcHJpc21hXCI7XG5pbXBvcnQgeyByZXF1aXJlUm9sZSB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgeyBHZXREYXlTdW1tYXJ5U2NoZW1hLCBEaXN0cmlidXRlU2NoZW1hLCBSZWNvbmNpbGVTY2hlbWEgfSBmcm9tIFwiQC9zZXJ2ZXIvdmFsaWRhdG9ycy9kaXN0cmlidXRpb25cIjtcbmltcG9ydCB7IGdldERheVRvdGFscyB9IGZyb20gXCJAL3NlcnZlci9xdWVyaWVzL2xlZGdlclwiO1xuaW1wb3J0IHsgZ2V0QWN0aXZlRGlzdHJpYnV0aW9uUnVsZSB9IGZyb20gXCJAL3NlcnZlci9xdWVyaWVzL3J1bGVzXCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXREYXlTdW1tYXJ5KHsgZGF0ZSB9OntkYXRlOnN0cmluZ30pe1xuICBjb25zdCBwYXJzZWQ9R2V0RGF5U3VtbWFyeVNjaGVtYS5zYWZlUGFyc2Uoe2RhdGV9KTsgaWYoIXBhcnNlZC5zdWNjZXNzKSB0aHJvdyBuZXcgRXJyb3IocGFyc2VkLmVycm9yLmVycm9ycy5tYXAoZT0+ZS5tZXNzYWdlKS5qb2luKFwiOyBcIikpO1xuICByZXR1cm4gZ2V0RGF5VG90YWxzKHBhcnNlZC5kYXRhLmRhdGUpO1xufVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRpc3RyaWJ1dGUoaW5wdXQ6eyBvbkhhbmQ6bnVtYmVyOyByb3dzOnsgZW52ZWxvcGVJZDpzdHJpbmc7IHBlcmNlbnQ/Om51bWJlcjsgYW1vdW50PzpudW1iZXIgfVtdOyBhbGxvd092ZXJyaWRlPzpib29sZWFuOyBvdmVycmlkZVJlYXNvbj86c3RyaW5nIH0pe1xuICBhd2FpdCByZXF1aXJlUm9sZShbXCJvcGVyYXRvclwiLFwibWFuYWdlclwiXSk7XG4gIGNvbnN0IHBhcnNlZD1EaXN0cmlidXRlU2NoZW1hLnNhZmVQYXJzZShpbnB1dCk7IGlmKCFwYXJzZWQuc3VjY2VzcykgdGhyb3cgbmV3IEVycm9yKHBhcnNlZC5lcnJvci5lcnJvcnMubWFwKGU9PmUubWVzc2FnZSkuam9pbihcIjsgXCIpKTtcbiAgY29uc3QgdG90YWw9cGFyc2VkLmRhdGEucm93cy5yZWR1Y2UoKHMscik9PnMrKHIuYW1vdW50fHwwKSwwKTtcbiAgY29uc3QgcnVsZT1hd2FpdCBnZXRBY3RpdmVEaXN0cmlidXRpb25SdWxlKCk7XG4gIGNvbnN0IHdhcm5pbmdzOnN0cmluZ1tdPVtdO1xuICBpZihydWxlICYmIHJ1bGUuaXRlbXMubGVuZ3RoICYmIHRvdGFsPjApe1xuICAgIGNvbnN0IG1hcD1uZXcgTWFwKHJ1bGUuaXRlbXMubWFwKGk9PltpLmVudmVsb3BlSWQsaS5wZXJjZW50XSkpO1xuICAgIGZvcihjb25zdCByIG9mIHBhcnNlZC5kYXRhLnJvd3MpeyBjb25zdCBleHA9bWFwLmdldChyLmVudmVsb3BlSWQpOyBpZih0eXBlb2YgZXhwPT09XCJudW1iZXJcIil7IGNvbnN0IHBjdD1NYXRoLnJvdW5kKCgoci5hbW91bnR8fDApL3RvdGFsKSoxMDApOyBpZihwY3QhPWV4cCkgd2FybmluZ3MucHVzaChgw4ljYXJ0IGJhcsOobWU6ICR7ci5lbnZlbG9wZUlkfSDigJQgYXR0ZW5kdSAke2V4cH0lIHZzICR7cGN0fSVgKTsgfSB9XG4gIH1cbiAgaWYod2FybmluZ3MubGVuZ3RoICYmICFwYXJzZWQuZGF0YS5hbGxvd092ZXJyaWRlKSB0aHJvdyBuZXcgRXJyb3IoXCLDiWNhcnRzIGF1IGJhcsOobWUg4oCUIGNvbmZpcm1hdGlvbiByZXF1aXNlIChhbGxvd092ZXJyaWRlICsgb3ZlcnJpZGVSZWFzb24pLlwiKTtcbiAgY29uc3QgdHg9YXdhaXQgcHJpc21hLnRyYW5zYWN0aW9uLmNyZWF0ZSh7IGRhdGE6eyBraW5kOlwiRElTVFwiLCBsYWJlbDpcIkRpc3RyaWJ1dGlvblwiLCBhbW91bnQ6dG90YWwsIGF0Om5ldyBEYXRlKCkgfSB9KTtcbiAgYXdhaXQgcHJpc21hLnRyYW5zYWN0aW9uQWxsb2NhdGlvbi5jcmVhdGVNYW55KHsgZGF0YTogcGFyc2VkLmRhdGEucm93cy5tYXAocj0+KHsgdHJhbnNhY3Rpb25JZDp0eC5pZCwgZW52ZWxvcGVJZDpyLmVudmVsb3BlSWQsIGFtb3VudDpyLmFtb3VudHx8MCB9KSkgfSk7XG4gIGlmKHdhcm5pbmdzLmxlbmd0aCl7IGF3YWl0IHByaXNtYS5hbm9tYWx5LmNyZWF0ZU1hbnkoeyBkYXRhOndhcm5pbmdzLm1hcCh3PT4oeyBsZXZlbDpcIndhcm5pbmdcIiwgY29kZTpcIkRJU1RSSUJVVElPTl9SVUxFX01JU01BVENIXCIsIGRldGFpbHM6IHBhcnNlZC5kYXRhLm92ZXJyaWRlUmVhc29uP2Ake3d9IOKAlCBSYWlzb246ICR7cGFyc2VkLmRhdGEub3ZlcnJpZGVSZWFzb259YDp3LCB0cmFuc2FjdGlvbklkOnR4LmlkIH0pKSB9KTsgfVxuICByZXR1cm4geyB0cmFuc2FjdGlvbklkOiB0eC5pZCwgd2FybmluZ3MgfTtcbn1cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZWNvbmNpbGUoaW5wdXQ6eyBkZWNsYXJlZE9uSGFuZDpudW1iZXIgfSl7XG4gIGF3YWl0IHJlcXVpcmVSb2xlKFtcIm9wZXJhdG9yXCIsXCJtYW5hZ2VyXCJdKTtcbiAgY29uc3QgcGFyc2VkPVJlY29uY2lsZVNjaGVtYS5zYWZlUGFyc2UoaW5wdXQpOyBpZighcGFyc2VkLnN1Y2Nlc3MpIHRocm93IG5ldyBFcnJvcihwYXJzZWQuZXJyb3IuZXJyb3JzLm1hcChlPT5lLm1lc3NhZ2UpLmpvaW4oXCI7IFwiKSk7XG4gIGNvbnN0IHRvZGF5SVNPPW5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLDEwKTsgY29uc3QgZGF5PWF3YWl0IGdldERheVRvdGFscyh0b2RheUlTTyk7XG4gIGNvbnN0IGRpZmY9cGFyc2VkLmRhdGEuZGVjbGFyZWRPbkhhbmQgLSBkYXkub25IYW5kOyBpZihkaWZmPT09MCkgcmV0dXJuIHsgb2s6dHJ1ZSwgZGlmZjowLCBzdWdnZXN0aW9uczpbXSBhcyBzdHJpbmdbXSB9O1xuICByZXR1cm4geyBvazpmYWxzZSwgZGlmZiwgc3VnZ2VzdGlvbnM6IGRpZmY+MD9bXCJWw6lyaWZpZXogdW5lIGVudHLDqWUgbWFucXVhbnRlLlwiXTpbXCJWw6lyaWZpZXogdW5lIGTDqXBlbnNlIG1hbnF1YW50ZS5cIl0gfTtcbn1cbiJdLCJuYW1lcyI6WyJwcmlzbWEiLCJyZXF1aXJlUm9sZSIsIkdldERheVN1bW1hcnlTY2hlbWEiLCJEaXN0cmlidXRlU2NoZW1hIiwiUmVjb25jaWxlU2NoZW1hIiwiZ2V0RGF5VG90YWxzIiwiZ2V0QWN0aXZlRGlzdHJpYnV0aW9uUnVsZSIsImdldERheVN1bW1hcnkiLCJkYXRlIiwicGFyc2VkIiwic2FmZVBhcnNlIiwic3VjY2VzcyIsIkVycm9yIiwiZXJyb3IiLCJlcnJvcnMiLCJtYXAiLCJlIiwibWVzc2FnZSIsImpvaW4iLCJkYXRhIiwiZGlzdHJpYnV0ZSIsImlucHV0IiwidG90YWwiLCJyb3dzIiwicmVkdWNlIiwicyIsInIiLCJhbW91bnQiLCJydWxlIiwid2FybmluZ3MiLCJpdGVtcyIsImxlbmd0aCIsIk1hcCIsImkiLCJlbnZlbG9wZUlkIiwicGVyY2VudCIsImV4cCIsImdldCIsInBjdCIsIk1hdGgiLCJyb3VuZCIsInB1c2giLCJhbGxvd092ZXJyaWRlIiwidHgiLCJ0cmFuc2FjdGlvbiIsImNyZWF0ZSIsImtpbmQiLCJsYWJlbCIsImF0IiwiRGF0ZSIsInRyYW5zYWN0aW9uQWxsb2NhdGlvbiIsImNyZWF0ZU1hbnkiLCJ0cmFuc2FjdGlvbklkIiwiaWQiLCJhbm9tYWx5IiwidyIsImxldmVsIiwiY29kZSIsImRldGFpbHMiLCJvdmVycmlkZVJlYXNvbiIsInJlY29uY2lsZSIsInRvZGF5SVNPIiwidG9JU09TdHJpbmciLCJzbGljZSIsImRheSIsImRpZmYiLCJkZWNsYXJlZE9uSGFuZCIsIm9uSGFuZCIsIm9rIiwic3VnZ2VzdGlvbnMiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/./src/server/actions/distribution.ts\n");

/***/ }),

/***/ "(action-browser)/./src/server/queries/ledger.ts":
/*!**************************************!*\
  !*** ./src/server/queries/ledger.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getDayTotals: () => (/* binding */ getDayTotals)\n/* harmony export */ });\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/prisma */ \"(action-browser)/./src/lib/prisma.ts\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"(action-browser)/./node_modules/.pnpm/next@15.0.3_@playwright+tes_c0fbebec67a33fb30e42c14d3a81a9d2/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);\n\n\nfunction startEnd(d) {\n    return {\n        start: new Date(d + \"T00:00:00.000Z\"),\n        end: new Date(d + \"T23:59:59.999Z\")\n    };\n}\nconst getDayTotals = (0,react__WEBPACK_IMPORTED_MODULE_1__.cache)(async (dateISO)=>{\n    const { start, end } = startEnd(dateISO);\n    const [i, o] = await Promise.all([\n        _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.transaction.aggregate({\n            _sum: {\n                amount: true\n            },\n            where: {\n                kind: \"IN\",\n                at: {\n                    gte: start,\n                    lte: end\n                }\n            }\n        }),\n        _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.transaction.aggregate({\n            _sum: {\n                amount: true\n            },\n            where: {\n                kind: \"OUT\",\n                at: {\n                    gte: start,\n                    lte: end\n                }\n            }\n        })\n    ]);\n    const _in = i._sum.amount ?? 0, _out = o._sum.amount ?? 0;\n    return {\n        in: _in,\n        out: _out,\n        onHand: _in - _out\n    };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL3NyYy9zZXJ2ZXIvcXVlcmllcy9sZWRnZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFzQztBQUErQjtBQUNyRSxTQUFTRSxTQUFTQyxDQUFRO0lBQUcsT0FBTztRQUFFQyxPQUFNLElBQUlDLEtBQUtGLElBQUU7UUFBbUJHLEtBQUksSUFBSUQsS0FBS0YsSUFBRTtJQUFrQjtBQUFHO0FBQ3ZHLE1BQU1JLGVBQWVOLDRDQUFLQSxDQUFDLE9BQU9PO0lBQ3ZDLE1BQU0sRUFBQ0osS0FBSyxFQUFDRSxHQUFHLEVBQUMsR0FBQ0osU0FBU007SUFDM0IsTUFBTSxDQUFDQyxHQUFFQyxFQUFFLEdBQUMsTUFBTUMsUUFBUUMsR0FBRyxDQUFDO1FBQzVCWiwrQ0FBTUEsQ0FBQ2EsV0FBVyxDQUFDQyxTQUFTLENBQUM7WUFBQ0MsTUFBSztnQkFBQ0MsUUFBTztZQUFJO1lBQUdDLE9BQU07Z0JBQUNDLE1BQUs7Z0JBQU1DLElBQUc7b0JBQUNDLEtBQUloQjtvQkFBTWlCLEtBQUlmO2dCQUFHO1lBQUM7UUFBQztRQUMzRk4sK0NBQU1BLENBQUNhLFdBQVcsQ0FBQ0MsU0FBUyxDQUFDO1lBQUNDLE1BQUs7Z0JBQUNDLFFBQU87WUFBSTtZQUFHQyxPQUFNO2dCQUFDQyxNQUFLO2dCQUFPQyxJQUFHO29CQUFDQyxLQUFJaEI7b0JBQU1pQixLQUFJZjtnQkFBRztZQUFDO1FBQUM7S0FDN0Y7SUFDRCxNQUFNZ0IsTUFBSWIsRUFBRU0sSUFBSSxDQUFDQyxNQUFNLElBQUUsR0FBR08sT0FBS2IsRUFBRUssSUFBSSxDQUFDQyxNQUFNLElBQUU7SUFBRyxPQUFPO1FBQUVRLElBQUdGO1FBQUtHLEtBQUlGO1FBQU1HLFFBQU9KLE1BQUlDO0lBQUs7QUFDaEcsR0FBRyIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxCQzI0MVxcTXVzaWNcXGZpbmFuY2UtYXBwLXYxLW1haW5cXGZpbmFuY2UtYXBwLXYxLW1haW5cXHNyY1xcc2VydmVyXFxxdWVyaWVzXFxsZWRnZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcHJpc21hIH0gZnJvbSBcIkAvbGliL3ByaXNtYVwiOyBpbXBvcnQgeyBjYWNoZSB9IGZyb20gXCJyZWFjdFwiO1xuZnVuY3Rpb24gc3RhcnRFbmQoZDpzdHJpbmcpeyByZXR1cm4geyBzdGFydDpuZXcgRGF0ZShkK1wiVDAwOjAwOjAwLjAwMFpcIiksIGVuZDpuZXcgRGF0ZShkK1wiVDIzOjU5OjU5Ljk5OVpcIikgfTsgfVxuZXhwb3J0IGNvbnN0IGdldERheVRvdGFscyA9IGNhY2hlKGFzeW5jIChkYXRlSVNPOnN0cmluZyk9PntcbiAgY29uc3Qge3N0YXJ0LGVuZH09c3RhcnRFbmQoZGF0ZUlTTyk7XG4gIGNvbnN0IFtpLG9dPWF3YWl0IFByb21pc2UuYWxsKFtcbiAgICBwcmlzbWEudHJhbnNhY3Rpb24uYWdncmVnYXRlKHtfc3VtOnthbW91bnQ6dHJ1ZX0sIHdoZXJlOntraW5kOlwiSU5cIiwgYXQ6e2d0ZTpzdGFydCxsdGU6ZW5kfX19KSxcbiAgICBwcmlzbWEudHJhbnNhY3Rpb24uYWdncmVnYXRlKHtfc3VtOnthbW91bnQ6dHJ1ZX0sIHdoZXJlOntraW5kOlwiT1VUXCIsIGF0OntndGU6c3RhcnQsbHRlOmVuZH19fSlcbiAgXSk7XG4gIGNvbnN0IF9pbj1pLl9zdW0uYW1vdW50Pz8wLCBfb3V0PW8uX3N1bS5hbW91bnQ/PzA7IHJldHVybiB7IGluOl9pbiwgb3V0Ol9vdXQsIG9uSGFuZDpfaW4tX291dCB9O1xufSk7XG4iXSwibmFtZXMiOlsicHJpc21hIiwiY2FjaGUiLCJzdGFydEVuZCIsImQiLCJzdGFydCIsIkRhdGUiLCJlbmQiLCJnZXREYXlUb3RhbHMiLCJkYXRlSVNPIiwiaSIsIm8iLCJQcm9taXNlIiwiYWxsIiwidHJhbnNhY3Rpb24iLCJhZ2dyZWdhdGUiLCJfc3VtIiwiYW1vdW50Iiwid2hlcmUiLCJraW5kIiwiYXQiLCJndGUiLCJsdGUiLCJfaW4iLCJfb3V0IiwiaW4iLCJvdXQiLCJvbkhhbmQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/./src/server/queries/ledger.ts\n");

/***/ }),

/***/ "(action-browser)/./src/server/queries/rules.ts":
/*!*************************************!*\
  !*** ./src/server/queries/rules.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   computeProposal: () => (/* binding */ computeProposal),\n/* harmony export */   getActiveDistributionRule: () => (/* binding */ getActiveDistributionRule)\n/* harmony export */ });\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/prisma */ \"(action-browser)/./src/lib/prisma.ts\");\n\nasync function getActiveDistributionRule() {\n    const now = new Date();\n    return _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.distributionRule.findFirst({\n        where: {\n            startsAt: {\n                lte: now\n            },\n            OR: [\n                {\n                    endsAt: null\n                },\n                {\n                    endsAt: {\n                        gt: now\n                    }\n                }\n            ]\n        },\n        include: {\n            items: {\n                include: {\n                    envelope: true\n                }\n            }\n        },\n        orderBy: {\n            startsAt: \"desc\"\n        }\n    });\n}\nfunction computeProposal(onHand, items) {\n    const res = items.map((i)=>({\n            envelopeId: i.envelopeId,\n            name: i.envelopeName,\n            percent: i.percent,\n            suggestedAmount: Math.floor(onHand * i.percent / 100)\n        }));\n    const sum = res.reduce((s, r)=>s + r.suggestedAmount, 0);\n    let diff = onHand - sum, idx = 0;\n    while(diff > 0 && res.length){\n        res[idx % res.length].suggestedAmount++;\n        idx++;\n        diff--;\n    }\n    return res;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL3NyYy9zZXJ2ZXIvcXVlcmllcy9ydWxlcy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBc0M7QUFDL0IsZUFBZUM7SUFDcEIsTUFBTUMsTUFBSSxJQUFJQztJQUNkLE9BQU9ILCtDQUFNQSxDQUFDSSxnQkFBZ0IsQ0FBQ0MsU0FBUyxDQUFDO1FBQUVDLE9BQU07WUFBRUMsVUFBUztnQkFBQ0MsS0FBSU47WUFBRztZQUFHTyxJQUFHO2dCQUFDO29CQUFDQyxRQUFPO2dCQUFJO2dCQUFFO29CQUFDQSxRQUFPO3dCQUFDQyxJQUFHVDtvQkFBRztnQkFBQzthQUFFO1FBQUM7UUFBR1UsU0FBUTtZQUFFQyxPQUFNO2dCQUFFRCxTQUFRO29CQUFFRSxVQUFTO2dCQUFLO1lBQUU7UUFBRTtRQUFHQyxTQUFRO1lBQUVSLFVBQVM7UUFBTztJQUFFO0FBQzlMO0FBQ08sU0FBU1MsZ0JBQWdCQyxNQUFhLEVBQUVKLEtBQThEO0lBQzNHLE1BQU1LLE1BQUlMLE1BQU1NLEdBQUcsQ0FBQ0MsQ0FBQUEsSUFBSTtZQUFFQyxZQUFXRCxFQUFFQyxVQUFVO1lBQUVDLE1BQUtGLEVBQUVHLFlBQVk7WUFBRUMsU0FBUUosRUFBRUksT0FBTztZQUFFQyxpQkFBaUJDLEtBQUtDLEtBQUssQ0FBQ1YsU0FBT0csRUFBRUksT0FBTyxHQUFDO1FBQUs7SUFDN0ksTUFBTUksTUFBSVYsSUFBSVcsTUFBTSxDQUFDLENBQUNDLEdBQUVDLElBQUlELElBQUVDLEVBQUVOLGVBQWUsRUFBQztJQUFJLElBQUlPLE9BQUtmLFNBQU9XLEtBQUtLLE1BQUk7SUFDN0UsTUFBTUQsT0FBSyxLQUFLZCxJQUFJZ0IsTUFBTSxDQUFDO1FBQUVoQixHQUFHLENBQUNlLE1BQUlmLElBQUlnQixNQUFNLENBQUMsQ0FBQ1QsZUFBZTtRQUFJUTtRQUFPRDtJQUFRO0lBQ25GLE9BQU9kO0FBQ1QiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcQkMyNDFcXE11c2ljXFxmaW5hbmNlLWFwcC12MS1tYWluXFxmaW5hbmNlLWFwcC12MS1tYWluXFxzcmNcXHNlcnZlclxccXVlcmllc1xccnVsZXMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcHJpc21hIH0gZnJvbSBcIkAvbGliL3ByaXNtYVwiO1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEFjdGl2ZURpc3RyaWJ1dGlvblJ1bGUoKXtcbiAgY29uc3Qgbm93PW5ldyBEYXRlKCk7XG4gIHJldHVybiBwcmlzbWEuZGlzdHJpYnV0aW9uUnVsZS5maW5kRmlyc3QoeyB3aGVyZTp7IHN0YXJ0c0F0OntsdGU6bm93fSwgT1I6W3tlbmRzQXQ6bnVsbH0se2VuZHNBdDp7Z3Q6bm93fX1dIH0sIGluY2x1ZGU6eyBpdGVtczp7IGluY2x1ZGU6eyBlbnZlbG9wZTp0cnVlIH0gfSB9LCBvcmRlckJ5Onsgc3RhcnRzQXQ6XCJkZXNjXCIgfSB9KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjb21wdXRlUHJvcG9zYWwob25IYW5kOm51bWJlciwgaXRlbXM6e2VudmVsb3BlSWQ6c3RyaW5nO3BlcmNlbnQ6bnVtYmVyO2VudmVsb3BlTmFtZTpzdHJpbmd9W10pe1xuICBjb25zdCByZXM9aXRlbXMubWFwKGk9Pih7IGVudmVsb3BlSWQ6aS5lbnZlbG9wZUlkLCBuYW1lOmkuZW52ZWxvcGVOYW1lLCBwZXJjZW50OmkucGVyY2VudCwgc3VnZ2VzdGVkQW1vdW50OiBNYXRoLmZsb29yKG9uSGFuZCppLnBlcmNlbnQvMTAwKSB9KSk7XG4gIGNvbnN0IHN1bT1yZXMucmVkdWNlKChzLHIpPT5zK3Iuc3VnZ2VzdGVkQW1vdW50LDApOyBsZXQgZGlmZj1vbkhhbmQtc3VtLCBpZHg9MDtcbiAgd2hpbGUoZGlmZj4wICYmIHJlcy5sZW5ndGgpeyByZXNbaWR4JXJlcy5sZW5ndGhdLnN1Z2dlc3RlZEFtb3VudCsrOyBpZHgrKzsgZGlmZi0tOyB9XG4gIHJldHVybiByZXM7XG59XG4iXSwibmFtZXMiOlsicHJpc21hIiwiZ2V0QWN0aXZlRGlzdHJpYnV0aW9uUnVsZSIsIm5vdyIsIkRhdGUiLCJkaXN0cmlidXRpb25SdWxlIiwiZmluZEZpcnN0Iiwid2hlcmUiLCJzdGFydHNBdCIsImx0ZSIsIk9SIiwiZW5kc0F0IiwiZ3QiLCJpbmNsdWRlIiwiaXRlbXMiLCJlbnZlbG9wZSIsIm9yZGVyQnkiLCJjb21wdXRlUHJvcG9zYWwiLCJvbkhhbmQiLCJyZXMiLCJtYXAiLCJpIiwiZW52ZWxvcGVJZCIsIm5hbWUiLCJlbnZlbG9wZU5hbWUiLCJwZXJjZW50Iiwic3VnZ2VzdGVkQW1vdW50IiwiTWF0aCIsImZsb29yIiwic3VtIiwicmVkdWNlIiwicyIsInIiLCJkaWZmIiwiaWR4IiwibGVuZ3RoIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(action-browser)/./src/server/queries/rules.ts\n");

/***/ }),

/***/ "(action-browser)/./src/server/validators/distribution.ts":
/*!***********************************************!*\
  !*** ./src/server/validators/distribution.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DistributeSchema: () => (/* binding */ DistributeSchema),\n/* harmony export */   GetDaySummarySchema: () => (/* binding */ GetDaySummarySchema),\n/* harmony export */   GetDistributionProposalSchema: () => (/* binding */ GetDistributionProposalSchema),\n/* harmony export */   ReconcileSchema: () => (/* binding */ ReconcileSchema)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(action-browser)/./node_modules/.pnpm/zod@3.23.8/node_modules/zod/lib/index.mjs\");\n\nconst GetDaySummarySchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    date: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/)\n});\nconst DistributeSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    onHand: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().nonnegative(),\n    rows: zod__WEBPACK_IMPORTED_MODULE_0__.z.array(zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n        envelopeId: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1),\n        percent: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().min(0).max(100).optional(),\n        amount: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().nonnegative().optional()\n    })).min(1),\n    allowOverride: zod__WEBPACK_IMPORTED_MODULE_0__.z.boolean().optional(),\n    overrideReason: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().max(500).optional()\n}).refine((v)=>v.rows.reduce((s, r)=>s + (r.amount ?? 0), 0) <= v.onHand, \"Montant distribué > montant en main\").refine((v)=>!v.allowOverride || v.overrideReason && v.overrideReason.trim().length >= 5, \"overrideReason (≥ 5 caractères) requis si allowOverride = true\");\nconst ReconcileSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    declaredOnHand: zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().nonnegative()\n});\nconst GetDistributionProposalSchema = GetDaySummarySchema;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL3NyYy9zZXJ2ZXIvdmFsaWRhdG9ycy9kaXN0cmlidXRpb24udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBd0I7QUFDakIsTUFBTUMsc0JBQXNCRCxrQ0FBQ0EsQ0FBQ0UsTUFBTSxDQUFDO0lBQUVDLE1BQU1ILGtDQUFDQSxDQUFDSSxNQUFNLEdBQUdDLEtBQUssQ0FBQztBQUF1QixHQUFHO0FBRXhGLE1BQU1DLG1CQUFtQk4sa0NBQUNBLENBQUNFLE1BQU0sQ0FBQztJQUN2Q0ssUUFBUVAsa0NBQUNBLENBQUNRLE1BQU0sR0FBR0MsR0FBRyxHQUFHQyxXQUFXO0lBQ3BDQyxNQUFNWCxrQ0FBQ0EsQ0FBQ1ksS0FBSyxDQUFDWixrQ0FBQ0EsQ0FBQ0UsTUFBTSxDQUFDO1FBQUVXLFlBQVliLGtDQUFDQSxDQUFDSSxNQUFNLEdBQUdVLEdBQUcsQ0FBQztRQUFJQyxTQUFTZixrQ0FBQ0EsQ0FBQ1EsTUFBTSxHQUFHQyxHQUFHLEdBQUdLLEdBQUcsQ0FBQyxHQUFHRSxHQUFHLENBQUMsS0FBS0MsUUFBUTtRQUFJQyxRQUFRbEIsa0NBQUNBLENBQUNRLE1BQU0sR0FBR0MsR0FBRyxHQUFHQyxXQUFXLEdBQUdPLFFBQVE7SUFBRyxJQUFJSCxHQUFHLENBQUM7SUFDeEtLLGVBQWVuQixrQ0FBQ0EsQ0FBQ29CLE9BQU8sR0FBR0gsUUFBUTtJQUFJSSxnQkFBZ0JyQixrQ0FBQ0EsQ0FBQ0ksTUFBTSxHQUFHWSxHQUFHLENBQUMsS0FBS0MsUUFBUTtBQUNyRixHQUFHSyxNQUFNLENBQUNDLENBQUFBLElBQUlBLEVBQUVaLElBQUksQ0FBQ2EsTUFBTSxDQUFDLENBQUNDLEdBQUVDLElBQUlELElBQUdDLENBQUFBLEVBQUVSLE1BQU0sSUFBRSxJQUFHLE1BQU1LLEVBQUVoQixNQUFNLEVBQUUsdUNBQ2pFZSxNQUFNLENBQUNDLENBQUFBLElBQUksQ0FBQ0EsRUFBRUosYUFBYSxJQUFLSSxFQUFFRixjQUFjLElBQUlFLEVBQUVGLGNBQWMsQ0FBQ00sSUFBSSxHQUFHQyxNQUFNLElBQUUsR0FBSSxrRUFBa0U7QUFFckosTUFBTUMsa0JBQWtCN0Isa0NBQUNBLENBQUNFLE1BQU0sQ0FBQztJQUFFNEIsZ0JBQWdCOUIsa0NBQUNBLENBQUNRLE1BQU0sR0FBR0MsR0FBRyxHQUFHQyxXQUFXO0FBQUcsR0FBRztBQUVyRixNQUFNcUIsZ0NBQWdDOUIsb0JBQW9CIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXEJDMjQxXFxNdXNpY1xcZmluYW5jZS1hcHAtdjEtbWFpblxcZmluYW5jZS1hcHAtdjEtbWFpblxcc3JjXFxzZXJ2ZXJcXHZhbGlkYXRvcnNcXGRpc3RyaWJ1dGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB6IH0gZnJvbSBcInpvZFwiO1xuZXhwb3J0IGNvbnN0IEdldERheVN1bW1hcnlTY2hlbWEgPSB6Lm9iamVjdCh7IGRhdGU6IHouc3RyaW5nKCkucmVnZXgoL15cXGR7NH0tXFxkezJ9LVxcZHsyfSQvKSB9KTtcbmV4cG9ydCB0eXBlIEdldERheVN1bW1hcnlJbnB1dCA9IHouaW5mZXI8dHlwZW9mIEdldERheVN1bW1hcnlTY2hlbWE+O1xuZXhwb3J0IGNvbnN0IERpc3RyaWJ1dGVTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIG9uSGFuZDogei5udW1iZXIoKS5pbnQoKS5ub25uZWdhdGl2ZSgpLFxuICByb3dzOiB6LmFycmF5KHoub2JqZWN0KHsgZW52ZWxvcGVJZDogei5zdHJpbmcoKS5taW4oMSksIHBlcmNlbnQ6IHoubnVtYmVyKCkuaW50KCkubWluKDApLm1heCgxMDApLm9wdGlvbmFsKCksIGFtb3VudDogei5udW1iZXIoKS5pbnQoKS5ub25uZWdhdGl2ZSgpLm9wdGlvbmFsKCkgfSkpLm1pbigxKSxcbiAgYWxsb3dPdmVycmlkZTogei5ib29sZWFuKCkub3B0aW9uYWwoKSwgb3ZlcnJpZGVSZWFzb246IHouc3RyaW5nKCkubWF4KDUwMCkub3B0aW9uYWwoKVxufSkucmVmaW5lKHY9PiB2LnJvd3MucmVkdWNlKChzLHIpPT5zKyhyLmFtb3VudD8/MCksMCkgPD0gdi5vbkhhbmQsIFwiTW9udGFudCBkaXN0cmlidcOpID4gbW9udGFudCBlbiBtYWluXCJcbikucmVmaW5lKHY9PiAhdi5hbGxvd092ZXJyaWRlIHx8ICh2Lm92ZXJyaWRlUmVhc29uICYmIHYub3ZlcnJpZGVSZWFzb24udHJpbSgpLmxlbmd0aD49NSksIFwib3ZlcnJpZGVSZWFzb24gKOKJpSA1IGNhcmFjdMOocmVzKSByZXF1aXMgc2kgYWxsb3dPdmVycmlkZSA9IHRydWVcIik7XG5leHBvcnQgdHlwZSBEaXN0cmlidXRlSW5wdXQgPSB6LmluZmVyPHR5cGVvZiBEaXN0cmlidXRlU2NoZW1hPjtcbmV4cG9ydCBjb25zdCBSZWNvbmNpbGVTY2hlbWEgPSB6Lm9iamVjdCh7IGRlY2xhcmVkT25IYW5kOiB6Lm51bWJlcigpLmludCgpLm5vbm5lZ2F0aXZlKCkgfSk7XG5leHBvcnQgdHlwZSBSZWNvbmNpbGVJbnB1dCA9IHouaW5mZXI8dHlwZW9mIFJlY29uY2lsZVNjaGVtYT47XG5leHBvcnQgY29uc3QgR2V0RGlzdHJpYnV0aW9uUHJvcG9zYWxTY2hlbWEgPSBHZXREYXlTdW1tYXJ5U2NoZW1hO1xuZXhwb3J0IHR5cGUgR2V0RGlzdHJpYnV0aW9uUHJvcG9zYWxJbnB1dCA9IHouaW5mZXI8dHlwZW9mIEdldERpc3RyaWJ1dGlvblByb3Bvc2FsU2NoZW1hPjtcbiJdLCJuYW1lcyI6WyJ6IiwiR2V0RGF5U3VtbWFyeVNjaGVtYSIsIm9iamVjdCIsImRhdGUiLCJzdHJpbmciLCJyZWdleCIsIkRpc3RyaWJ1dGVTY2hlbWEiLCJvbkhhbmQiLCJudW1iZXIiLCJpbnQiLCJub25uZWdhdGl2ZSIsInJvd3MiLCJhcnJheSIsImVudmVsb3BlSWQiLCJtaW4iLCJwZXJjZW50IiwibWF4Iiwib3B0aW9uYWwiLCJhbW91bnQiLCJhbGxvd092ZXJyaWRlIiwiYm9vbGVhbiIsIm92ZXJyaWRlUmVhc29uIiwicmVmaW5lIiwidiIsInJlZHVjZSIsInMiLCJyIiwidHJpbSIsImxlbmd0aCIsIlJlY29uY2lsZVNjaGVtYSIsImRlY2xhcmVkT25IYW5kIiwiR2V0RGlzdHJpYnV0aW9uUHJvcG9zYWxTY2hlbWEiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/./src/server/validators/distribution.ts\n");

/***/ })

};
;